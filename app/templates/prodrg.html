{% extends 'base.html' %}

{% block content %}
<script>
	document.title = "{{ _('Enzima + Ligante (PRODRG)') }} - Visual Dynamics"
</script>
<div>
  <div class="alert alert-info mt-2" role="alert">
    {{ _('Para solicitar o cancelamento de uma dinâmica em andamento envie um email para ') }}<a class="alert-link" href="mailto://fernando.zanchi@fiocruz.br">fernando.zanchi@fiocruz.br</a>
  </div>

  <p class="h2 text-center">{{ _("Enzima + Ligante (PRODRG)") }}</p>
  
  {% with steps = get_flashed_messages(category_filter=["steps"]) %}
  {% if steps %}
  <div class="d-flex justify-content-center mx-auto">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <p class="h2 text-center">{{ _("Dinâmica em andamento") }}</p>
  <p class="h4 text-center">{{ _("Proteína %(protein)s", protein=name_dynamic) }}</p>
  {% if '#productionmd' in steplist %}
  <p class="h6 text-center">{{ date_finish }}</p>
  {% endif %}
  <script>
    setInterval(function() {
      document.location.reload(true)
    }, 10000);
  </script>
  {% include 'components/run-progress.html' %}
  {% else %}
  <div class="d-flex flex-column flex-lg-row justify-content-evenly">
    <form class="align-items-start max-md mx-auto" method="POST" action="{{ url_for('DynamicRoutes.prodrg') }}" onsubmit="return validateProcessing()" enctype="multipart/form-data"> 
      {% include 'components/run-progress.html' %}
      <div class="my-2">
        <label class="form-label" for="file">{{ _("Proteína Livre") }} (.pdb)</label>
        <input class="form-control form-control-lg" type="file" name="file" id="file" accept=".pdb" required>
      </div>

      <div class="my-2">
        <label class="form-label" for="fileitp">{{ _("Ligante") }} (.itp)</label>
        <input class="form-control form-control-lg" type="file" name="fileitp" id="fileitp" accept=".itp" required>
      </div>

      <div class="my-2">
        <label class="form-label" for="filegro">{{ _("Ligante") }} (.pdb ou .gro)</label>
        <input class="form-control form-control-lg" type="file" name="filegro" id="filegro" accept=".gro,.pdb" required>
      </div>
      
      <div class="my-2">
        <div class="form-floating">
          <select disabled class="form-select" id="campoforca" name="campoforca">
            <option selected value="gromos53a5">GROMOS 53a6 force field</option>
          </select>
          <label for="campoforca">{{ _("Campo de Força") }}</label>
        </div>
      </div>
      
      <div class="my-2">
        <div class="form-floating">
          <select class="form-select" id="modeloagua" name="modeloagua">
            <option value="spc" selected>SPC simple point charge ({{ _("Recomendado para GROMOS") }})</option>
            <option value="spce">SPC/E extended simple point charge</option>
            <option value="none">None</option>
            <option value="tip3p">TIP3P ({{ _("AMBER e OPLS apenas") }})</option>
            <option value="tip4p">TIP4P ({{ _("AMBER e OPLS apenas") }})</option>
            <option value="tip5p">TIP5P ({{ _("AMBER e OPLS apenas") }})</option>
          </select>
          <label for="modeloagua">{{ _("Modelo de Água") }}</label>
        </div>
      </div>

      <div class="my-2">
        <div class="form-floating">
          <select class="form-select" name="tipocaixa" id="tipocaixa">
            <option value="cubic" selected>Cubic</option>
            <option value="triclinic">Triclinic</option>
            <option value="dodecahedron">Dodecahedron</option>
            <option value="octahedron">Octahedron</option>
          </select>
          <label class="form-label" for="tipocaixa">{{ _("Tipo de Caixa") }}</label>
        </div>
      </div>
      
      <div class="my-2">
        <div class="form-floating">
          <input type="number" class="form-control" value="0" name="distanciacaixa" min="0" step="0.1" id="distanciacaixa">
          <label for="distanciacaixa">{{ _("Distância entre a proteína e a borda da caixa (nm)") }}</label>
        </div>
      </div>
      
      <div class="my-2">
        <div class="form-floating">
          <input class="form-control" type="number" value="2" disabled="disabled">
          <label for="ns">{{ _("Tempo de Simulação") }} (ns)</label>
        </div>
      </div>

      <div class="form-check my-1">
        <input class="form-check-input" type="checkbox" checked="checked" disabled="disabled" name="neutralize" id="neutralize">
        <label class="form-check-label" for="neutralize">{{ _("Neutralizar o Sistema") }}</label>
      </div>
      
      <div class="form-check my-1">
        <input class="form-check-input" type="checkbox" disabled="disabled" id="double">
        <label class="form-check-label" for="double">{{ _("Calcular em dupla precisão") }}</label>
        <input type="hidden" name="double" value="False">
      </div>
      
      <div class="form-check my-1">
        <input class="form-check-input" type="checkbox" name="ignore" id="ignore">
        <label class="form-check-label" for="ignore">{{ _("Ignorar Hidrogênios") }}</label>
      </div>
      
      <div class="row">
        <button class="my-2 btn btn-primary" value="Executar" name="execute" onclick="setTimeout(function(){ window.location.reload(true) }, 1000);">
          <i class="fa fa-cogs" aria-hidden="true"></i> {{ _("Executar") }}
        </button>
        <div class="d-flex justify-content-between">
          <button class="my-2 btn btn-success" value="Download" name="download">
            <i class="fa fa-file-download" aria-hidden="true"></i> {{ _("Baixar Lista de Comandos") }}
          </button>
          <a class="my-2 btn btn-primary" href="{{ url_for('DownloadRoutes.downloadmdpfiles') }}">
            <i class="fas fa-download" aria-hidden="true"></i>  {{ _("Baixar arquivos MDP") }}
          </a>
        </div>
      </div>
    </form>
    <div class="d-flex flex-column">
      <label class="my-3 border-bottom border-primary" for="">{{ _("Gerando arquivos com PRODRG") }}</label>
      <video class="mx-auto" width="512" height="256" controls>
        <source src="{{ url_for('static', filename='video/arquivosPRODRG.mp4') }}" type="video/mp4">
      </video>         
  
      <label class="my-3 border-bottom border-primary">{{ _("Tutorial de como realizar a dinâmica") }}</label>
      <video class="mx-auto" width="512" height="256" controls>
        <source src="{{ url_for('static', filename='video/dinamicaPRODRG.mp4') }}" type="video/mp4">
      </video>   
    </div>
  </div>
  {% endif %}
  {% endwith %}
</div>

<script>
  function validateProcessing() {
    var filename = document.querySelector('#file').value;
    var filenameitp = document.querySelector('#fileitp').value;
    var filenamegro = document.querySelector('#filegro').value;
    var distance = document.querySelector('#distanciacaixa').value;
    if (filename === "" || filename == null) {
      alert('Deve ser selecionado um arquivo (.pdb)');
      return false
    }
    if (filenameitp === "" || filenameitp == null) {
      alert('Deve ser selecionado um arquivo (.itp)');
      return false
    }
    if (filenamegro === "" || filenamegro == null) {
      alert('Deve ser selecionado um arquivo (.gro ou .pdb)');
      return false
    }
    if (distance === "" || distance == null) {
      alert('Deve ser selecionada a distância');
      return false
    }
  };
  
</script>

{% endblock %}