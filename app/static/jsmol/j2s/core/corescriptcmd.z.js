(function(aa,ba,ca,da,ea,fa,Q,M,R,T,U,A,V,W,ga,P,I,X,O,Y,ha,Z,ia,ja,ka,la,ma,na,oa,pa,B,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,l,$){Q("JS");R(null,"JS.ScriptExt",["JU.AU"],function(){c$=U(function(){this.e=this.vwr=null;this.chk=!1;this.st=null;this.slen=0;T(this,arguments)},JS,"ScriptExt");l(c$,"init",function(a){this.e=a;this.vwr=this.e.vwr;return this},"~O");l(c$,"atomExpressionAt",function(a){return this.e.atomExpressionAt(a)},"~N");l(c$,"checkLength",
function(a){this.e.checkLength(a)},"~N");l(c$,"error",function(a){this.e.error(a)},"~N");l(c$,"invArg",function(){this.e.invArg()});l(c$,"invPO",function(){this.error(23)});l(c$,"getShapeProperty",function(a,c){return this.e.getShapeProperty(a,c)},"~N,~S");l(c$,"paramAsStr",function(a){return this.e.paramAsStr(a)},"~N");l(c$,"centerParameter",function(a){return this.e.centerParameter(a,null)},"~N");l(c$,"floatParameter",function(a){return this.e.floatParameter(a)},"~N");l(c$,"getPoint3f",function(a,
c){return this.e.getPoint3f(a,c,!0)},"~N,~B");l(c$,"intParameter",function(a){return this.e.intParameter(a)},"~N");l(c$,"isFloatParameter",function(a){switch(this.e.tokAt(a)){case 2:case 3:return!0}return!1},"~N");l(c$,"setShapeProperty",function(a,c,b){this.e.setShapeProperty(a,c,b)},"~N,~S,~O");l(c$,"showString",function(a){this.e.showString(a)},"~S");l(c$,"stringParameter",function(a){return this.e.stringParameter(a)},"~N");l(c$,"getToken",function(a){return this.e.getToken(a)},"~N");l(c$,"tokAt",
function(a){return this.e.tokAt(a)},"~N");l(c$,"setShapeId",function(a,c,b){b&&this.invArg();c=this.e.setShapeNameParameter(c).toLowerCase();this.setShapeProperty(a,"thisID",c);return c},"~N,~N,~B");l(c$,"getColorTrans",function(a,c,b,e){b=3.4028235E38;1765808134!=a.theTok&&--c;switch(this.tokAt(c+1)){case 603979967:c++;b=this.isFloatParameter(c+1)?a.getTranslucentLevel(++c):this.vwr.getFloat(570425353);break;case 1073742074:c++,b=0}a.isColorParam(c+1)?e[0]=a.getArgbParam(++c):1073742333==this.tokAt(c+
1)?(e[0]=0,a.iToken=c+1):3.4028235E38==b?this.invArg():e[0]=-2147483648;return b},"JS.ScriptEval,~N,~B,~A");l(c$,"finalizeObject",function(a,c,b,e,f,d,j,h){f&&this.setShapeProperty(a,"set",d);-2147483648!=c&&this.e.setShapePropertyBs(a,"color",Integer.$valueOf(c),h);3.4028235E38!=b&&this.e.setShapeTranslucency(a,"","translucent",b,h);0!=e&&this.setShapeProperty(a,"scale",Integer.$valueOf(e));0<j&&(this.e.setMeshDisplayProperty(a,j,0)||this.invArg())},"~N,~N,~N,~N,~B,~O,~N,JU.BS");l(c$,"getIntArray2",
function(a){a=this.e.getToken(a).getList();for(var c=JU.AU.newInt2(a.size()),b=c.length;0<=--b;){var e=a.get(b).getList();null==e&&this.invArg();c[b]=I(e.size(),0);for(var f=c[b].length;0<=--f;)c[b][f]=e.get(f).intValue}return c},"~N");l(c$,"getAllPoints",function(a,c){var b=null,e=null;try{switch(this.e.tokAt(a)){case 7:b=this.e.getPointArray(a,-1,!1);break;case 12290:case 10:case 1073742325:e=this.atomExpressionAt(a)}null==b&&(null==e&&(e=this.vwr.getAllAtoms()),b=this.bsToArray(e))}catch(f){if(!P(f,
Exception))throw f;}(null==b||b.length<c)&&this.invArg();return b},"~N,~N");l(c$,"bsToArray",function(a){for(var c=Array(a.cardinality()),b=a.nextSetBit(0),e=0;0<=b;b=a.nextSetBit(b+1))c[e++]=this.vwr.ms.at[b];return c},"JU.BS")});Q("JS");R(["JS.ScriptExt"],"JS.CmdExt","java.lang.Boolean $.Float $.Long java.util.Hashtable $.Map JU.AU $.BS $.Base64 $.Lst $.M3 $.M4 $.Measure $.P3 $.P4 $.PT $.Quat $.SB $.V3 J.api.Interface J.atomdata.RadiusData J.c.STER $.VDW J.i18n.GT JM.Atom $.AtomCollection $.BondSet $.LabelToken $.Measurement $.ModelSet JS.SV $.ScriptCompiler $.ScriptError $.ScriptEval $.ScriptInterruption $.ScriptMathProcessor $.ScriptParam $.T JU.BSUtil $.BoxInfo $.C $.Edge $.Elements $.Escape $.Logger $.Parser $.Point3fi $.SimpleUnitCell JV.FileManager $.StateManager $.Viewer".split(" "),
function(){c$=Y(JS,"CmdExt",JS.ScriptExt);W(c$,function(){Z(this,JS.CmdExt,[])});$(c$,"dispatch",function(a,c,b){this.chk=this.e.chk;this.slen=this.e.slen;this.st=b;switch(a){case 1073741866:b[0].value=this.prepareBinaryOutput(b[0]);break;case 4098:this.assign();break;case 134221829:this.cache();break;case 4102:this.calculate();break;case 4103:this.capture();break;case 4105:this.centerAt();break;case 134221831:this.compare();break;case 528395:this.console();break;case 4106:this.connect(1);break;case 1094717448:this.configuration();
break;case 134221834:this.data();break;case 1613238294:this.connect(0);break;case 4120:this.image();break;case 4122:this.invertSelected();break;case 4124:this.macro();break;case 4125:this.mapProperty();break;case 4126:this.minimize();break;case 603983903:this.modelkit();break;case 1275072532:this.modulation();break;case 4130:this.mutate();break;case 4131:this.navigate();break;case 4133:case 134221850:case 4138:this.plot(b);break;case 134222350:this.show();break;case 528443:this.stereo();break;case 1814695966:this.unitcell(c?
2:1,!1);break;case 134221856:return this.write(c?b:null);case 6:this.measure();break;case 21:this.polyhedra();break;case 20:this.ellipsoid();break;case 4:this.struts()}return null},"~N,~B,~A");l(c$,"macro",function(){if(!this.chk){var a=this.e.optParameterAsString(1);if(0==a.length)this.showString(this.vwr.getMacro(null));else{var c=this.vwr.getMacro(a);null==c?this.showString("macro "+a+" could not be found. Current macros include:\n"+this.vwr.getMacro(null)):(this.showString("running "+c),this.e.cmdScript(4124,
c,null))}}});l(c$,"evalParallel",function(a,c){this.chk=this.e.chk;this.slen=this.e.slen;var b=(new JS.ScriptEval).setViewer(this.vwr);b.historyDisabled=!0;b.compiler=new JS.ScriptCompiler(this.vwr);b.sm=c;try{b.restoreScriptContext(a,!0,!1,!1),b.setAllowJSThreads(!1),b.dispatchCommands(!1,!1,!1)}catch(e){if(P(e,Exception))return this.e.vwr.setStringProperty("_errormessage",""+e),null==b.thisContext&&(JU.Logger.error("Error evaluating context "+e),e.printStackTrace()),!1;throw e;}return!0},"JS.ScriptContext,JV.ShapeManager");
l(c$,"getBitsetIdent",function(a,c,b,e,f,d){return this.getBitsetIdentFull(a,c,b,e,f,d,null)},"JU.BS,~S,~O,~B,~N,~B");l(c$,"getBitsetIdentFull",function(a,c,b,e,f,d,j){var h=!M(b,JM.BondSet);h&&(null==c?c=this.vwr.getStandardLabelFormat(0):0==c.length&&(c="%[label]"));var g=null==c?-1:c.indexOf("%"),n=2147483647!=f;if(null==a||this.chk||h&&0>g)return null==c&&(c=""),d?B(-1,[c]):c;var g=this.vwr.ms,m=0,r=g.getLabeler();b=h||!e?null:b.associatedAtoms;e=null==c||0==c.length;var t=h||e?null:JM.LabelToken.getBondLabelValues();
c=e?null:h?r.compile(this.vwr,c,"\x00",null):r.compile(this.vwr,c,"\u0001",t);var k=n?1:a.cardinality(),q=null!=j;q||(j=Array(k));var v=new JU.P3;for(f=n?f:a.nextSetBit(0);0<=f;f=a.nextSetBit(f+1)){var w;h?w=e?g.at[f].getInfo():r.formatLabelAtomArray(this.vwr,g.at[f],c,"\x00",b,v):(w=g.bo[f],w=e?w.getIdentity():r.formatLabelBond(this.vwr,w,c,t,b,v));w=JU.PT.formatStringI(w,"#",m+1);j[q?f:m]=w;m++;if(n)break}return 1==k&&!d?j[0]:j},"JU.BS,~S,~O,~B,~N,~B,~A");l(c$,"getLoadSymmetryParams",function(a,
c,b){var e=this.e;this.chk=e.chk;this.slen=e.slen;var f=!1,d=null,j=this.tokAt(a);if(1073742332==j||8==j)d=e.getFractionalPoint(a),j=this.tokAt(a=e.iToken+1);switch(j){case 134217764:f=b.get("isEmptyLoad")===Boolean.TRUE;case 1073741938:case 1073742080:case 1094713350:case 1073742163:case 1073742114:case 1814695966:null==d&&(d=JU.P3.new3(555,555,-1)),e.iToken=a-1}j=null;if(null!=d){b.put("lattice",d);a=e.iToken+1;c.append(" "+JU.SimpleUnitCell.escapeMultiplier(d));a=this.checkPacked(a,b,c);1094713350==
this.tokAt(a)&&(b.put("centroid",Boolean.TRUE),c.append(" CENTROID"),a=this.checkPacked(++a,b,c));if(1073742163==this.tokAt(a)){var h;c.append(" SUPERCELL ");if(e.isPoint3f(++a)){h=this.getPoint3f(a,!1);if(h.x!=A(h.x)||h.y!=A(h.y)||h.z!=A(h.z)||1>h.x||1>h.y||1>h.z)e.iToken=a,this.invArg();a=e.iToken}else h=this.stringParameter(a);c.append(JU.Escape.e(h));b.put("supercell",h);a=this.checkPacked(++a,b,c)}h=0;1073742114==this.tokAt(a)&&(a++,h=this.floatParameter(a++),c.append(" range "+h));b.put("symmetryRange",
Float.$valueOf(h));h=null;var g,n=-2147483648;134217764==this.tokAt(a)&&(++a,h=JU.PT.rep(this.paramAsStr(a++),"''",'"'),c.append(" spacegroup "+JU.PT.esc(h)),h.equalsIgnoreCase("ignoreOperators")?n=-999:(0==h.length?(g=this.vwr.getCurrentUnitCell(),null!=g&&(h=g.getSpaceGroupName())):0<=h.indexOf(",")&&9>d.x&&(9>d.y&&0==d.z)&&(h+="#doNormalize=0"),b.put("spaceGroupName",h),n=-2));d=null;if(1814695966==this.tokAt(a)){++a;g=e.optParameterAsString(a);0==g.length?(g=this.vwr.getCurrentUnitCell(),null!=
g&&(d=g.getUnitCellAsArray(!0),j=g.getCartesianOffset())):4==this.tokAt(a)?(d=O(6,0),JU.SimpleUnitCell.setOabc(g,d,null)):d=e.floatParameterSet(a,6,9);(null==d||6!=d.length&&9!=d.length)&&this.invArg();c.append(" unitcell [");for(a=0;a<d.length;a++)c.append((0==a?"":" ")+d[a]);c.append("]");b.put("unitcell",d);-2147483648==n&&(n=-1);a=e.iToken+1}-2147483648!=n&&b.put("spaceGroupIndex",Integer.$valueOf(n));f&&null==d&&null!=h&&JU.PT.parseInt(h)}f=!1;null==j&&1073742066==this.tokAt(a)&&(j=this.getPoint3f(++a,
!0),f=e.coordinatesAreFractional);null!=j&&(f?(j.setT(e.fractionalPoint),b.put("unitCellOffsetFractional",f?Boolean.TRUE:Boolean.FALSE),c.append(" offset {"+j.x+" "+j.y+" "+j.z+"/1}")):c.append(" offset "+JU.Escape.eP(j)),b.put("unitCellOffset",j),a=e.iToken+1);return a},"~N,JU.SB,java.util.Map");l(c$,"checkPacked",function(a,c,b){switch(this.tokAt(a)){case 1073741938:c.put("packed",Boolean.TRUE);var e=null,f=this.tokAt(++a);switch(f){case 1814695966:case 1678381065:break;default:this.e.isArrayParameter(a)?
(e=this.e.getPointArray(a,-1,!1),a=this.e.iToken):this.isFloatParameter(a)?(e=this.floatParameter(a),e=B(-1,[new JU.P3,JU.P3.new3(e,e,e)])):(e=[],--a)}a++;if(this.e.chk)break;switch(f){case 1814695966:e=this.e.optParameterAsString(a++).toLowerCase();if(JU.PT.isOneOf(e,";conventional;primitive;"))return c.put("fillRange",e),b.append(' FILL UNITCELL "'+e+'"'),a;e=this.vwr.getCurrentUnitCell();if(null!=e){e=JU.BoxInfo.toOABC(e.getUnitCellVerticesNoOffset(),e.getCartesianOffset());break}case 1678381065:e=
JU.BoxInfo.toOABC(this.vwr.ms.getBBoxVertices(),null)}switch(e.length){case 2:f=e[1];e=B(-1,[e[0],JU.P3.newP(e[0]),new JU.P3,new JU.P3]);e[1].x=f.x;e[2].y=f.y;e[3].z=f.z;break;case 3:e=B(-1,[new JU.P3,e[0],e[1],e[2]]);break;case 4:break;default:e=B(-1,[new JU.P3,JU.P3.new3(10,0,0),JU.P3.new3(0,10,0),JU.P3.new3(0,0,10)])}c.put("fillRange",e);b.append(" FILL ["+e[0]+e[1]+e[2]+e[3]+"]");break;case 1073742080:e=NaN,this.isFloatParameter(++a)&&(e=this.floatParameter(a++)),this.e.chk||(c.put("packed",Boolean.TRUE),
b.append(" PACKED"),Float.isNaN(e)||(c.put("packingError",Float.$valueOf(e)),b.append(" "+e)))}return a},"~N,java.util.Map,JU.SB");l(c$,"cache",function(){var a=this.tokAt(1),c=null,b=2;switch(a){case 1275069441:case 1073742119:c=this.e.optParameterAsString(b++);case 1073741882:this.checkLength(b);this.chk||("all".equals(c)&&(c=null),c=this.vwr.cacheFileByName(c,1275069441==a),this.showString(0>c?"cache cleared":c+" bytes "+(1275069441==a?" cached":" removed")));break;default:this.invArg()}});l(c$,
"calculate",function(){var a=!1,c=!1,b=null,e=null,f=this.e,d=-2147483648,d=-1;if(2<=(f.iToken=f.slen))switch(f.clearDefinedVariableAtomSets(),this.getToken(1).tok){case 2:if(3!=this.intParameter(1)||!this.paramAsStr(2).equalsIgnoreCase("D"))break;0>this.vwr.am.cmi&&f.errorStr(30,"calculate 3D");b="load append $ filter '2D';select visible;center selected";f.optParameterAsString(3).equalsIgnoreCase("ZAP")&&(b+=";zap modelIndex="+Math.max(this.vwr.am.cmi,0));this.chk||f.runScript(b);return;case 1073741824:this.checkLength(2);
break;case 134217764:f.iToken=1;b=2==this.slen?null:this.atomExpressionAt(2);f.checkLast(f.iToken);this.chk||f.showString(""+this.vwr.findSpaceGroup(b,null,null,!0,!1));return;case 1086324752:f.iToken=1;b=2==this.slen?null:this.atomExpressionAt(2);f.checkLast(f.iToken);this.chk||f.showString(this.vwr.calculateChirality(b));return;case 1631586315:this.checkLength(2);if(this.chk)return;d=this.vwr.calculateFormalCharges(null);this.showString(J.i18n.GT.i(J.i18n.GT.$("{0} charges modified"),d));return;
case 1075838996:this.checkLength(2);this.chk||this.vwr.ms.assignAromaticBondsBs(!0,null);return;case 1613238294:2!=f.slen&&(b=(c=1639976963==this.tokAt(++f.iToken))?this.vwr.bsA():this.atomExpressionAt(f.iToken),!c&&1639976963!=this.tokAt(++f.iToken)&&(e=this.atomExpressionAt(f.iToken)));if(this.chk)return;d=this.vwr.autoHbond(b,e,!1);-2147483648!=d&&f.report(J.i18n.GT.i(J.i18n.GT.$("{0} hydrogen bonds"),Math.abs(d)),!1);return;case 1612709900:a=this.tokAt(2);(c=1073742335==a)?f.iToken++:528443==
a&&f.iToken++;b=this.slen==f.iToken+1?null:this.atomExpressionAt(f.iToken+1);null==b&&528443==a&&(b=this.vwr.getAtomBitSet("_C & connected(3) & !connected(double)"));f.checkLast(f.iToken);this.chk||(this.vwr.addHydrogens(b,0),c&&(null==b&&(b=this.vwr.bsA()),this.vwr.makeConnections(0.1,1E8,515,1073742025,b,b,null,!1,!1,0),this.vwr.ms.assignAromaticBondsBs(!0,null)));return;case 1111492619:f.iToken=1;b=2==this.slen?null:this.atomExpressionAt(2);f.checkLast(f.iToken);this.chk||f.getPartialCharges(b);
return;case 1088421903:case 1275068447:this.chk||(1275203608==this.tokAt(2)?(a=4==this.tokAt(3)?this.stringParameter(3):null,b=null!=a||3==this.slen?null:this.atomExpressionAt(3),b=B(-1,[a,null,b]),this.showString(f.getShapePropertyData(21,"symmetry",b)?b[1]:"")):(b=2==this.slen?this.vwr.bsA():this.atomExpressionAt(2),this.showString(this.vwr.ms.calculatePointGroup(b))));return;case 1111490574:this.checkLength(2);this.chk||(this.vwr.calculateStraightness(),this.vwr.addStateScript("set quaternionFrame '"+
this.vwr.getQuaternionFrame()+"'; calculate straightness",!1,!0));return;case 1639976963:b=4>this.slen||this.isFloatParameter(3)?null:this.atomExpressionAt(2);switch(this.tokAt(++f.iToken)){case 4138:break;case 1111490587:if(this.chk)return;f.showString(this.vwr.getAnnotationParser(!0).calculateDSSRStructure(this.vwr,b));return;case 1073741915:c=!0;d=this.slen==f.iToken+1?-1:A(this.floatParameter(++f.iToken));break;case 0:c=this.vwr.getBoolean(603979826);break;default:this.invArg()}this.chk||this.showString(this.vwr.calculateStructures(b,
c,!0,d));return;case 659482:b=f.iToken+1<this.slen?this.atomExpressionAt(++f.iToken):null;e=f.iToken+1<this.slen?this.atomExpressionAt(++f.iToken):null;this.checkLength(++f.iToken);this.chk||(d=this.vwr.calculateStruts(b,e),0<d&&(this.setShapeProperty(1,"type",Integer.$valueOf(32768)),f.setShapePropertyBs(1,"color",Integer.$valueOf(16777215),null),f.setShapeTranslucency(1,"","translucent",0.5,null),this.setShapeProperty(1,"type",Integer.$valueOf(1023))),this.showString(J.i18n.GT.i(J.i18n.GT.$("{0} struts added"),
d)));return;case 2097180:a=!0;case 1111490575:c=!1;switch(this.tokAt(2)){case 134217759:f.iToken++;break;case 0:c=!a;break;case 1073741952:c=!0;f.iToken++;break;default:c=!0}b=f.iToken+1<this.slen?this.atomExpressionAt(++f.iToken):this.vwr.bsA();this.checkLength(++f.iToken);this.chk||this.vwr.calculateSurface(b,c?3.4028235E38:-1);return}f.errorStr2(53,"CALCULATE","3D? aromatic? hbonds? hydrogen? formalCharge? partialCharge? pointgroup? straightness? structure? struts? surfaceDistance FROM? surfaceDistance WITHIN?")});
l(c$,"capture",function(){if(!this.chk&&!this.vwr.allowCapture())this.showString("Cannot capture on this platform");else{var a=this.vwr.captureParams,c=null==a?"GIF":a.get("type"),b=0,e=0,f=this.e.slen,d="",j=1073742070!=this.vwr.am.animationReplayMode,h=1,g=this.tokAt(h),n=603979967==g;n&&(g=this.tokAt(++h));var m=null;switch(0==g?g=102409:g){case 4:d=this.e.optParameterAsString(h++);if(0==d.length){e=102409;break}c=d.toLowerCase();c.endsWith(".gift")||c.endsWith(".pngt")?(n=!0,d=d.substring(0,d.length-
1),c=d.toLowerCase()):!c.endsWith(".gif")&&!c.contains(".png")&&(d+=".gif");c.endsWith(".png")?(c.endsWith("0.png")||(d=d.substring(0,d.length-4)+"0000.png"),c="PNG"):c="GIF";n&&(c+="T");g=d.indexOf("0000.");g=0>g||g!=d.lastIndexOf(".")-4;e=!1;528411==this.tokAt(h)&&(j=!0,this.tokAt(++h));switch(this.tokAt(h)){case 134222850:m=this.stringParameter(++h);break;case 1073742129:e=!0;case 1611141175:a="y";j=!0;h++;e?(h<f&&2!=this.tokAt(h)&&(a=this.e.optParameterAsString(h++).toLowerCase()),m="rotate Y 10 10;rotate Y -10 -10;rotate Y -10 -10;rotate Y 10 10",
f=h<f?this.intParameter(h++):5,m=0>f?JU.PT.rep(m,"10;",""+-f+";"):JU.PT.rep(m,"10",""+f)):(h<f&&(a=this.e.optParameterAsString(h++).toLowerCase()),m="rotate Y 360 30;");if(this.chk)return;this.vwr.setNavigationMode(!1);if(""===a||0>"xyz".indexOf(a))a="y";m=JU.PT.rep(m,"Y",a);break;case 3:case 2:b=this.floatParameter(h++)}if(this.chk)return;if(null!=m){m="set waitformoveto true;"+m+";set waitformoveto "+this.vwr.g.waitForMoveTo;m="capture "+(n?"transparent ":"")+JU.PT.esc(d)+(j?" LOOP;":";")+m+";capture end;";
this.e.cmdScript(0,null,m);return}e=1073742031;a=new java.util.Hashtable;n=this.vwr.getInt(553648132);g&&(a.put("streaming",Boolean.TRUE),j||this.showString(J.i18n.GT.o(J.i18n.GT.$("Note: Enable looping using the LOOP keyword just after the file name or {0}"),B(-1,["ANIMATION MODE LOOP"]))),this.showString(J.i18n.GT.o(J.i18n.GT.$("Animation delay based on: {0}"),B(-1,["ANIMATION FPS "+n]))));a.put("captureFps",Integer.$valueOf(n));break;case 102409:case 1073741874:null!=a&&a.put("captureSilent",Boolean.TRUE);
case 1073742335:case 1073742334:this.checkLength(-2);e=g;break;default:this.invArg()}this.chk||null==a||(a.put("type",c),c=Integer.$valueOf(this.vwr.getBackgroundArgb()),a.put("backgroundColor",c),a.put("fileName",d),a.put("quality",Integer.$valueOf(-1)),a.put("endTime",Long.$valueOf(0>=b?-1:System.currentTimeMillis()+V(1E3*b))),a.put("captureMode",JS.T.nameOf(e).toLowerCase()),a.put("captureLooping",j?Boolean.TRUE:Boolean.FALSE),b=this.vwr.processWriteOrCapture(a),null==b&&(b="canceled"),JU.Logger.info(b))}});
l(c$,"centerAt",function(){var a=this.getToken(1).tok;switch(a){case 1073741826:case 96:case 1678381065:break;default:this.invArg()}var c=JU.P3.new3(0,0,0);5==this.slen?(c.x=this.floatParameter(2),c.y=this.floatParameter(3),c.z=this.floatParameter(4)):this.e.isCenterParameter(2)?(c=this.centerParameter(2),this.e.checkLast(this.e.iToken)):this.checkLength(2);!this.chk&&!this.vwr.isJmolDataFrame()&&this.vwr.tm.setCenterAt(a,c)});l(c$,"compare",function(){var a=this.e,c=!1,b=!1,e=!1,f=!1,d=!1,j=null,
h=null,g=null,n=null,m=null,r=null;a.iToken=0;var t=this.isFloatParameter(1)?this.floatParameter(++a.iToken):NaN,k=null,q=null,v=null,f=0;if(4115==this.tokAt(1))q=this.vwr.bsA();else if(q=this.atomExpressionAt(1),a.isArrayParameter(++a.iToken))k=a.getPointArray(a.iToken,-1,!1);else if(1140850689!=(f=this.tokAt(a.iToken))&&4115!=f)v=this.atomExpressionAt(a.iToken);var w=null,u=!1,p=!1,s=null,l=JU.BSUtil.copy(q);null!=v&&l.or(v);for(var K=null==k&&null!=v&&l.equals(q),l=K,D=1140850689==f,G=!1,y=a.iToken+
1;y<this.slen;++y)switch(this.getToken(y).tok){case 4115:l=!0;null==v&&(v=JU.BSUtil.copy(q));break;case 134218757:if(u=!0,f=this.tokAt(y+1),4!=f&&1275203608!=f){s="*";break}case 134218756:s=(p=1275203608==this.tokAt(++y))?"polyhedra":this.stringParameter(y);if(s.equalsIgnoreCase("polyhedra")||s.equalsIgnoreCase("polyhedron"))p=!0;break;case 1677721602:b=d=!0;s=this.paramAsStr(++y);s.equalsIgnoreCase("SMILES")&&(u=!0,1612709900==this.e.tokAt(y+1)?(s="H",y++):s="*");break;case 3:case 2:t=Math.abs(this.floatParameter(y));
break;case 268435504:break;case 2109448:w=this.atomExpressionAt(++y);y=a.iToken;break;case 10:case 1073742325:null!=r&&this.invArg();g=this.atomExpressionAt(a.iToken);f=K?0:this.tokAt(a.iToken+1);n=null==k&&a.isArrayParameter(a.iToken+1)?null:10==f||1073742325==f?this.atomExpressionAt(++a.iToken):JU.BSUtil.copy(g);null!=w&&(g.and(w),null!=n&&n.and(w));null==n?(f=a.iToken,k=a.getPointArray(a.iToken+1,-1,!1),null==k?a.iToken=f:G=!0):null!=v&&n.and(v);null==m&&(m=new JU.Lst);m.addLast(B(-1,[g,null==
n?k:n]));D&&(k=null);y=a.iToken;break;case 1275203608:u=p=!0;break;case 4125:break;case 7:null!=m&&this.invArg();c=!0;j=a.getQuaternionArray(a.theToken.getList(),1073742001);this.getToken(++y);h=a.getQuaternionArray(a.theToken.getList(),1073742001);null==r&&(r=new JU.Lst);r.addLast(B(-1,[j,h]));break;case 1073742077:c=!0;break;case 1140850689:D=!0;c=!1;break;case 134217751:c=!1;break;case 528432:b=!0;break;case 4160:e=!0;break;default:this.invArg()}if(!this.chk){l&&(t=0);Float.isNaN(t)||0>t?t=1:!b&&
!e&&(b=e=!0);f=0!=t;(D=!c&&null==s&&!p||null!=k)&&J.api.Interface.getInterface("JU.Eigen",this.vwr,"script");null==m&&null==r&&(p&&null==w&&(w=this.vwr.getAtomBitSet("polyhedra")),null==w?(g=D?this.vwr.getAtomBitSet("spine"):new JU.BS,0>g.nextSetBit(0)?(g=q,n=v):(n=JU.BSUtil.copy(g),g.and(q),n.and(v))):(g=JU.BSUtil.copy(q),n=JU.BSUtil.copy(v),g.and(w),g.and(q),null!=n&&(n.and(w),n.and(v))),m=new JU.Lst,m.addLast(B(-1,[g,n])));K=null;if(l)for(var K=this.vwr.ms.getModelBS(q,!1),w=Array(K.cardinality()),
y=0,F=K.nextSetBit(0);0<=F;F=K.nextSetBit(F+1),y++)w[y]=this.vwr.getModelUndeletedAtomsBitSet(F);else K=JU.BSUtil.newAndSetBit(0),w=B(-1,[q]);for(var C=0,F=K.nextSetBit(0);C<w.length;C++,F=K.nextSetBit(F+1)){var q=w[C],x=O(2,0);if(l&&p&&0==C)v=q;else{var E=null,z=new JU.Lst,L=null,N=l?new JU.Lst:m;if(!G)for(y=0;y<m.size();++y){var H=m.get(y);l&&N.addLast(H=B(-1,[JU.BSUtil.copy(H[0]),H[1]]));H[0].and(q)}var A=null,I=null;if(D){null!=k&&(N.clear(),N.addLast(B(-1,[g,k])));try{L=this.vwr.getCenterAndPoints(N,
!0)}catch(Q){if(P(Q,Exception))this.invArg();else throw Q;}E=L[0].length-1;for(y=1;y<=E;y++){z=L[0][y];H=L[1][y];if(!M(z,JM.Atom)||!M(H,JM.Atom))break;l||JU.Logger.info(" atom 1 "+z.getInfo()+"\tatom 2 "+H.getInfo())}E=JU.Measure.calculateQuaternionRotation(L,x);y=Float.isNaN(x[1])?NaN:Math.round(100*x[0])/100;x=Float.isNaN(x[1])?NaN:Math.round(100*x[1])/100;this.showString("RMSD "+y+" --\x3e "+x+" Angstroms")}else if(c){if(null==r)for(y=0;y<N.size();y++){H=N.get(y);j=this.vwr.getAtomGroupQuaternions(H[0],
2147483647);h=this.vwr.getAtomGroupQuaternions(H[1],2147483647);for(E=0;E<j.length&&E<h.length;E++)z.addLast(h[E].div(j[E]))}else for(E=0;E<j.length&&E<h.length;E++)z.addLast(h[E].div(j[E]));x[0]=0;j=z.toArray(Array(z.size()));E=JU.Quat.sphereMean(j,x,1E-4);this.showString("RMSD = "+x[0]+" degrees")}else{y=new JU.M4;A=new JU.P3;if(null!=q&&null!=s&&("H".equals(s)||"*".equals(s)||"".equals(s)))try{s=this.vwr.getSmilesOpt(q,-1,-1,"H".equals(s)?4096:0,null)}catch(S){if(P(S,Exception))a.evalError(S.getMessage(),
null);else throw S;}if(d){var R;if(null==q||null==v||null==(R=a.getSmilesExt().getFlexFitList(q,v,s,!u)))break;this.vwr.setDihedrals(R,null,1)}p?(x=JU.BS.copy(g),x.and(q),z=JU.BS.copy(n),z.and(v),x=a.getSmilesExt().mapPolyhedra(x.nextSetBit(0),z.nextSetBit(0),u,y)):x=a.getSmilesExt().getSmilesCorrelation(q,v,s,null,null,y,null,!1,null,A,!1,32|(u?1:2));if(Float.isNaN(x)){this.showString("structures do not match from "+q+" to "+v);break}e&&(I=new JU.V3,y.getTranslation(I));b&&(E=new JU.M3,y.getRotationScale(E),
E=JU.Quat.newM(E));this.showString("RMSD = "+x+" Angstroms");l&&(y=this.vwr.getV0abc(F,B(-1,[y])),null!=y&&a.setModelCagePts(F,y,null))}null!=L&&(A=L[0][0]);null==A&&(L=this.vwr.getCenterAndPoints(N,!0),A=L[0][0]);N=new JU.P3;x=NaN;e&&(null==I&&(I=JU.V3.newVsub(L[1][0],A)),x=1E10);if(b&&(null==E&&a.evalError("option not implemented",null),N.add2(A,E.getNormal()),x=E.getTheta(),0==x&&e))if(0.01<I.length())x=1E10;else if(l)continue;else b=e=f=!1;if(!Float.isNaN(x)&&!Float.isNaN(N.x)&&(L=null,b&&(e&&
0!=t)&&(L=this.vwr.ms.getAtomPointVector(q),y=JS.ScriptMathProcessor.getMatrix4f(E.getMatrix(),I),L=JU.Measure.transformPoints(L,y,A)),a.useThreads()||(f=!1),this.vwr.rotateAboutPointsInternal(a,A,N,x/t,x,f,q,I,L,null,null)&&f&&a.isJS))throw new JS.ScriptInterruption(a,"compare",1);}}}});l(c$,"configuration",function(){var a=null,c=this.vwr.bsA();if(1==this.slen){if(this.chk)return;a=this.vwr.ms.setConformation(c);this.vwr.ms.addStateScript("select",null,c,null,"configuration",!0,!1)}else if(this.isFloatParameter(1)){c=
this.intParameter(this.e.checkLast(1));if(this.chk)return;a=this.vwr.ms.getConformation(this.vwr.am.cmi,c-1,!0,null);this.vwr.addStateScript("configuration "+c+";",!0,!1)}else{a=this.atomExpressionAt(1);if(this.chk)return;c=this.intParameter(this.e.checkLast(this.e.iToken+1));this.vwr.addStateScript("configuration "+JU.Escape.eBS(a)+" "+c+";",!0,!1);a=this.vwr.ms.getConformation(this.vwr.am.cmi,c-1,!0,a)}this.setShapeProperty(1,"type",Integer.$valueOf(30720));this.e.setShapeSizeBs(1,0,a);this.vwr.autoHbond(a,
a,!0);this.vwr.selectStatus(a,!1,0,this.e.tQuiet,!1)});l(c$,"measure",function(){var a=this.e,c=null,b=0,e=null;if(2==this.slen)switch(this.tokAt(1)){case 1073742334:this.setShapeProperty(6,"hideAll",Boolean.TRUE);return;case 12291:this.chk||this.vwr.clearAllMeasurements();return}this.vwr.shm.loadShape(6);switch(this.tokAt(1)){case 134218756:var f=this.stringParameter(3==this.slen?2:4);if(this.chk)return;var d=this.vwr.ms.at,c=this.vwr.ms.ac,b=null;try{b=this.vwr.getSmilesMatcher().getCorrelationMaps(f,
d,c,this.vwr.bsA(),2)}catch(j){if(P(j,Exception))a.evalError(j.getMessage(),null);else throw j;}if(null==b)return;this.setShapeProperty(6,"maps",b);return}switch(this.slen){case 2:switch(this.getToken(1).tok){case 0:case 1073742335:this.vwr.shm.loadShape(6);this.setShapeProperty(6,"hideAll",Boolean.FALSE);return;case 1073742001:this.chk||a.showStringPrint(this.vwr.getMeasurementInfoAsString(),!1);return;case 4:this.setShapeProperty(6,"setFormats",this.stringParameter(1));return}a.errorStr(24,"ON, OFF, DELETE");
break;case 3:switch(this.getToken(1).tok){case 12291:if(1073742327==this.getToken(2).tok)this.chk||this.vwr.clearAllMeasurements();else{var h=this.intParameter(2)-1;this.chk||this.vwr.deleteMeasurement(h)}return}}for(var g=0,n=0,m=-1,r=-1,t=-1,k=I(5,0),q=O(-1,[3.4028235E38,3.4028235E38]),v=!1,l=!1,u=!1,p=!0,s=null,B=null,f=268435538,K=d=null,D=null,G=null,y=new JU.Lst,F=new JU.BS,C=null,x=null,E=0,z=0,L=NaN,N=null,h=1;h<this.slen;++h)switch(this.getToken(h).tok){case 1073741974:1!=h&&this.invArg();
c=a.optParameterAsString(++h);continue;case 1073741824:a.errorStr(24,"ALL, ALLCONNECTED, DELETE");break;default:this.error(15);break;case 268435568:134217736!=this.tokAt(h+1)&&this.invArg();h++;u=!0;break;case 1073741832:N=this.paramAsStr(++h).toLowerCase();break;case 134217736:case 1073741834:case 1073742327:l=1073741834==a.theTok;r=-1;v=!0;l&&u&&this.invArg();break;case 1765808134:b=JU.C.getColix(a.getArgbParam(++h));h=a.iToken;break;case 1073742066:a.isPoint3f(++h)?(e=this.getPoint3f(h,!1),e=O(-1,
[1,e.x,e.y,e.z,0,0,0])):e=a.floatParameterSet(h,7,7);h=a.iToken;break;case 1665140738:case 1073741917:z=A((1665140738==a.theTok?2E3:1E3)*this.floatParameter(++h));null!=c&&0>=z&&(z=-1);break;case 3:null!=s&&this.invArg();p=v=!0;t=(t+1)%2;q[t]=this.floatParameter(h);break;case 12291:268435538!=f&&this.invArg();f=12291;break;case 4114:var H=this.floatParameter(++h),Q=this.paramAsStr(++h),R=this.paramAsStr(++h);this.chk||(G=this.vwr.getFont3D(Q,R,H));break;case 2:H=this.intParameter(h);if(v)p=!0,t=(t+
1)%2,q[t]=H;else{r=this.vwr.ms.getFirstAtomIndexFromAtomNumber(H,this.vwr.getVisibleFramesBitSet());if(!this.chk&&0>r)return;null!=C&&this.invArg();4<(k[0]=++g)&&a.bad();k[g]=r}break;case 1094713359:m=this.intParameter(++h);break;case 1073742334:268435538!=f&&this.invArg();f=1073742334;break;case 1073742335:268435538!=f&&this.invArg();f=1073742335;break;case 1073742114:p=v=!0;r=-1;break;case 1073741989:case 1073741990:B=Boolean.$valueOf(1073741989==a.theTok);v=!0;u=1073741990==a.theTok;break;case 1648363544:0<=
t&&this.invArg();s=a.encodeRadiusParameter(h,!1,!0);if(null==s)return;s.values=q;h=a.iToken;v=u=!0;B=Boolean.$valueOf(!1);1==E&&(E++,g++,H=JU.BSUtil.copy(F),JU.BSUtil.invertInPlace(H,this.vwr.ms.ac),H.and(this.vwr.ms.getAtomsWithinRadius(5,F,!1,null,null)),y.addLast(H));break;case 12290:case 10:case 1073742325:E++;case 1073742332:case 8:case 1073742330:0<=r&&this.invArg();g=Array(1);C=a.centerParameter(h,g);if(M(g[0],JU.BS)&&(C=F=g[0],!this.chk&&0==F.length()))return;M(C,JU.P3)&&(h=new JU.Point3fi,
h.setT(C),h.mi=m,C=h);4<(g=++n)&&a.bad();h=a.iToken;y.addLast(C);break;case 1715472409:K=this.paramAsStr(h);break;case 1073742188:L=this.floatParameter(++h);break;case 4:H=this.stringParameter(h);JM.Measurement.isUnits(H)?D=H:d=H;break;case 1073742164:x=a.tickParamAsStr(h,!1,!0,!0),h=a.iToken,f=12290}(null!=s&&(0<=t||2!=g)||2>g&&null==c&&(null==x||1==g))&&a.bad();null!=d&&0!=d.indexOf(g+":")&&(d=g+":"+d);p&&q[1]<q[0]&&(q[1]=q[0],q[0]=3.4028235E38==q[1]?3.4028235E38:-200);if(!this.chk)if(a=null!=c&&
null==C&&268435538==f,null!=C||null!=x||a){null==s&&(s=new J.atomdata.RadiusData(q,0,null,null));null!=x&&(x.id="default");if(a)f=266284;else if(null!=C&&(null!=K||null!=d)&&268435538==f)f=12290;k=null;if(null!=G||null!=N||0!=b||null!=d&&(a||0<=d.indexOf("\n")))k=J.api.Interface.getInterface("JM.Text",this.vwr,"script").newMeasure(this.vwr,G,b);null!=k&&(k.pymolOffset=e,k.setAlignmentLCR(N));this.setShapeProperty(6,"measure",this.vwr.newMeasurementData(c,y).set(f,null,s,K,d,D,x,l,u,B,v,z,b,k,L))}else switch(a=
null==c?k:c,f){case 12291:this.setShapeProperty(6,"delete",a);break;case 1073742335:this.setShapeProperty(6,"show",a);break;case 1073742334:this.setShapeProperty(6,"hide",a);break;default:this.setShapeProperty(6,null==d?"toggle":"toggleOn",a),null!=d&&this.setShapeProperty(6,"setFormats",d)}});l(c$,"connect",function(a){var c=this.e,b=O(2,0),e=Array(2);e[0]=e[1]=this.vwr.bsA();var f=NaN,d=I(-1,[-2147483648]),j=0,h=131071,g=1073742026,n=!1,m=!1,r=!1,t=3.4028235E38,k=!1,q=0,v=0,l=new JU.BS,u=!1,p=0,
s=0,A=0,K=!1;if(1==this.slen)this.chk||this.vwr.rebondState(c.$isStateScript);else if(1073877011==this.tokAt(1))this.chk||this.vwr.connectNBO(this.e.optParameterAsString(2));else{for(;a<this.slen;++a){switch(this.getToken(a).tok){case 1073742335:case 1073742334:this.checkLength(2);this.chk||this.vwr.rebondState(c.$isStateScript);return;case 2:case 3:if(0<q){(m||k)&&c.error(23);h=JU.Edge.getBondOrderFromFloat(this.floatParameter(a));131071==h&&this.invArg();m=!0;break}2<++v&&c.bad();var D=this.floatParameter(a);
268435634==this.tokAt(a+1)&&(D=-D/100,a++);b[j++]=D;break;case 12290:case 10:case 1073742325:(2<q||u&&0<q)&&c.bad();(m||k)&&this.invArg();e[q++]=this.atomExpressionAt(a);u=c.isBondSet;if(2==q){for(var D=c.iToken,G=a;G<D;G++)if(1073741824==this.tokAt(G)&&this.paramAsStr(G).equals("_1")){p=a;break}c.iToken=D}a=c.iToken;break;case 1086324742:K=!0;break;case 1765808134:case 603979967:case 1073742074:k=!0;t=this.getColorTrans(c,a,!1,d);a=c.iToken;break;case 1073742086:d=1073741852==this.tokAt(2);this.checkLength(d?
3:2);if(this.chk)return;this.vwr.clearModelDependentObjects();this.vwr.ms.deleteAllBonds();f=new JU.BS;this.vwr.ms.setPdbConectBonding(0,0,f);if(d){c=c.$isStateScript&&this.vwr.getBoolean(603979872);this.vwr.ms.autoBondBs4(null,null,f,null,this.vwr.getMadBond(),c,null);this.vwr.addStateScript(c?"set legacyAutoBonding TRUE;connect PDB AUTO;set legacyAutoBonding FALSE;":"connect PDB auto;",!1,!0);return}this.vwr.addStateScript("connect PDB;",!1,!0);return;case 1073741830:case 1073741852:case 1073741904:case 1073742025:case 1073742026:r=
!0;++a!=this.slen&&this.invArg();g=c.theTok;1073741852==g&&!(131071==h||2048==h||515==h)&&this.invArg();break;case 659482:k||(d[0]=16777215,t=0.5,f=this.vwr.getFloat(570425406),k=!0),r||(g=1073742026,r=!0);case 1073741824:if(c.isColorParam(a)){s=-a;break}case 1075838996:case 1613238294:h=this.paramAsStr(a);131071==(h=JS.ScriptParam.getBondOrderFromString(h))&&this.invArg();m&&c.error(18);m=!0;switch(h){case 33:switch(this.tokAt(a+1)){case 3:h=JS.ScriptParam.getPartialBondOrderFromFloatEncodedInt(this.st[++a].intValue);
break;case 2:h=this.intParameter(++a)}break;case 2048:2==this.tokAt(a+1)&&(h=this.intParameter(++a)<<11,A=this.floatParameter(++a));break;case 65537:r||(g=1073742025,r=!0)}break;case 1665140738:f=this.floatParameter(++a);k=!0;break;case 1073742333:++a!=this.slen&&this.invArg();case 12291:g=12291;n=!0;k=!1;break;default:s=a}0<a&&(s==-a||s==a&&c.isColorParam(a)?(k=!0,d[0]=c.getArgbParam(a),a=c.iToken):s==a&&this.invArg())}if(!this.chk){2>j&&(0==j&&(b[0]=1E8),b[1]=b[0],b[0]=0.1);k&&(m||(h=65535),r||
(g=1073742025));m=j=0;if(0<p){A=new JU.BS;this.vwr.definedAtomSets.put("_1",A);K=e[0];for(r=K.nextSetBit(0);0<=r;r=K.nextSetBit(r+1))A.set(r),e=this.vwr.makeConnections(b[0],b[1],h,g,A,this.atomExpressionAt(p),l,u,!1,0),j+=Math.abs(e[0]),m+=e[1],A.clear(r)}else e=this.vwr.makeConnections(b[0],b[1],h,g,e[0],e[1],l,u,K,A),j+=Math.abs(e[0]),m+=e[1];b=c.doReport();n?b&&c.report(J.i18n.GT.i(J.i18n.GT.$("{0} connections deleted"),m),!1):(k&&(this.vwr.selectBonds(l),Float.isNaN(f)||c.setShapeSizeBs(1,Math.round(2E3*
f),null),this.finalizeObject(1,d[0],t,0,!1,null,0,l),this.vwr.selectBonds(null)),b&&c.report(J.i18n.GT.o(J.i18n.GT.$("{0} new bonds; {1} modified"),B(-1,[Integer.$valueOf(j),Integer.$valueOf(m)])),!1))}}},"~N");l(c$,"console",function(){switch(this.getToken(1).tok){case 1073742334:this.chk||this.vwr.showConsole(!1);break;case 1073742335:this.chk||this.vwr.showConsole(!0);break;case 1073741882:this.chk||this.vwr.sm.clearConsole();break;case 134221856:this.showString(this.stringParameter(2));break;
default:this.invArg()}});l(c$,"data",function(){var a=this.e,c=null,b=null,e=!1,f;switch(a.iToken=this.slen){case 5:c=this.paramAsStr(2);case 4:case 2:b=this.paramAsStr(1);if(b.equalsIgnoreCase("clear")){this.chk||this.vwr.setData(null,null,0,0,0,0,0);return}if(0<=(f=b.indexOf("@")))c=""+a.getParameter(b.substring(f+1),4,!0),b=b.substring(0,f).trim();else if(null==c&&0<=(f=b.indexOf(" ")))c=b.substring(f+1).trim(),b=b.substring(0,f).trim(),e=!0;break;default:a.bad()}f=b.substring(0,(b+" ").indexOf(" ")).toLowerCase();
if(f.equals("model")||f.equals("append"))a.cmdLoad();else if(!this.chk){var d=0<=b.toLowerCase().indexOf("(default)");if(f.equals("connect_atoms"))this.vwr.ms.connect(this.parseDataArray(c,!1));else if(0==f.indexOf("ligand_"))this.vwr.setLigandModel(b.substring(7).toUpperCase()+"_data",c.trim());else if(0==f.indexOf("file_"))this.vwr.setLigandModel(b.substring(5)+"_file",c.trim());else if(a=Array(4),f.equals("element_vdw")){a[0]=f;a[1]=c.$replace(";","\n");c=JU.Elements.elementNumberMax;f=I(c+1,0);
for(d=1;d<=c;d++)f[d]=d;a[2]=f;a[3]=Integer.$valueOf(0);this.vwr.setData("element_vdw",a,c,0,0,0,0)}else if(0==f.indexOf("data2d_"))a[0]=b,a[1]=this.parseDataArray(c,!1),a[3]=Integer.$valueOf(2),this.vwr.setData(b,a,0,0,0,0,0);else if(0==f.indexOf("data3d_"))a[0]=b,a[1]=this.parseDataArray(c,!0),a[3]=Integer.$valueOf(3),this.vwr.setData(b,a,0,0,0,0,0);else{var j=JU.PT.getTokens(b);if(0==f.indexOf("property_")&&!(2==j.length&&j[1].equals("set"))){d=this.vwr.bsA();a[0]=f;var h=e?0:this.vwr.getP("propertyAtomNumberField").intValue(),
g=e?0:this.vwr.getP("propertyAtomNumberColumnCount").intValue(),n=e?-2147483648:this.vwr.getP("propertyDataField").intValue(),m=e?0:this.vwr.getP("propertyDataColumnCount").intValue();!e&&0<=b.indexOf(" ")&&(3==j.length&&(h=JU.PT.parseInt(j[1]),n=JU.PT.parseInt(j[2])),5==j.length&&(h=JU.PT.parseInt(j[1]),g=JU.PT.parseInt(j[2]),n=JU.PT.parseInt(j[3]),m=JU.PT.parseInt(j[4])));0>h&&(h=0);0>n&&(n=0);b=this.vwr.ms.ac;e=null;j=JU.BS.newN(b);if(0<h){for(var e=I(b+2,0),r=0;r<=b;r++)e[r]=-1;for(r=d.nextSetBit(0);0<=
r;r=d.nextSetBit(r+1)){var t=this.vwr.ms.at[r].getAtomNumber();t>b+1||(0>t||j.get(t))||(j.set(t),e[t]=r)}a[2]=e}else a[2]=JU.BSUtil.copy(d);a[1]=c;a[3]=Integer.$valueOf(0);this.vwr.setData(f,a,b,h,g,n,m)}else"occupany".equals(f)&&(f="occupancy"),h=JM.AtomCollection.getUserSettableType(f),-1<h?this.vwr.setAtomData(h,f,c,d):(a[0]=b,a[1]=c,a[3]=Integer.$valueOf(0),this.vwr.setData(f,a,0,0,0,0,0))}}});l(c$,"ellipsoid",function(){var a=this.e,c=0,b=1,e=3.4028235E38,f=!1,d=!1;this.setShapeProperty(20,"thisID",
null);switch(this.getToken(1).tok){case 1073742335:c=2147483647;break;case 1073742334:break;case 2:c=this.intParameter(1);break;case 36867:this.e.sm.loadShape(20);this.setShapeProperty(20,"select",this.paramAsStr(2));b=a.iToken;d=f=!0;break;case 1073741974:case 268435633:case 1073741824:this.e.sm.loadShape(20);1073741974==a.theTok&&b++;this.setShapeId(20,b,!1);b=a.iToken;f=!0;break;default:this.invArg()}if(f){for(c=I(-1,[-2147483648]);++b<this.slen;){var f=this.paramAsStr(b),j=null;this.getToken(b);
if(!d)switch(a.theTok){case 1073742330:f="points";j=Array(3);j[0]=a.objectNameParameter(++b);if(this.chk)continue;a.getShapePropertyData(24,"getVertices",j);break;case 1825200146:j=this.e.optParameterAsString(++b);if(0==j.length)continue;break;case 1611272194:var j=Array(3),h=null;switch(this.getToken(b+1).tok){case 11:for(var b=a.theToken.value,g=3;0<=--g;)b.getColumnV(g,j[g]=new JU.V3);break;case 1073742195:b+=2;case 268435520:h=new JU.Lst;for(g=3;0<=--g;){switch(this.tokAt(++b)){case 268435520:break;
default:a.isCenterParameter(b)?h.addLast(JS.SV.newV(8,this.centerParameter(b))):268435520!=this.tokAt(b)&&h.addLast(this.getToken(b))}b=a.iToken}268435521!=this.getToken(++b).tok&&this.invArg();break;case 7:h=a.theToken.getList();switch(h.size()){case 1:h=new JU.Lst;for(g=3;0<=--g;)h.addLast(this.getToken(++b));break;case 3:break;default:this.invArg()}break;default:for(g=0;3>g;g++)j[g]=new JU.V3,j[g].setT(this.centerParameter(++b)),b=a.iToken}if(null!=h)for(b=3;0<=--b;)switch(g=h.get(b),g.tok){case 7:j[b]=
JU.V3.new3(JS.SV.fValue(g.getList().get(0)),JS.SV.fValue(g.getList().get(1)),JS.SV.fValue(g.getList().get(2)));break;case 8:j[b]=JU.V3.newV(g.value)}b=a.iToken;break;case 12289:j=this.centerParameter(++b);b=a.iToken;break;case 1094713359:j=Integer.$valueOf(this.intParameter(++b));break;case 12291:j=Boolean.TRUE,this.checkLength(b+1)}if(null==j)switch(a.theTok){case 1073742335:f="on";j=Boolean.TRUE;break;case 1073742334:f="on";j=Boolean.FALSE;break;case 536875009:this.isFloatParameter(b+1)?j=Float.$valueOf(this.floatParameter(++b)):
a.isCenterParameter(b)?(b=this.centerParameter(b),j=O(-1,[b.x,b.y,b.z])):j=a.floatParameterSet(++b,3,3);b=a.iToken;break;case 12290:case 10:case 1073742325:f="atoms";j=this.atomExpressionAt(b);b=a.iToken;break;case 1765808134:case 603979967:case 1073742074:e=this.getColorTrans(a,b,!0,c);b=a.iToken;continue;case 1073742075:j=this.paramAsStr(++b)}null==j&&this.invArg();this.setShapeProperty(20,f.toLowerCase(),j)}this.finalizeObject(20,c[0],e,0,!1,null,0,null);this.setShapeProperty(20,"thisID",null)}else a.setShapeSizeBs(20,
c,null)});l(c$,"image",function(){this.chk||this.vwr.getConsole();var a=1,c=null;1073741974==this.tokAt(1)&&(c=this.e.optParameterAsString(++a),a++);var b=this.e.optParameterAsString(a),e=this.e.optParameterAsString(this.slen-1).equalsIgnoreCase("close");if(!e&&(this.slen==a||this.slen==a+2))b=this.slen==a+2?this.intParameter(a++):-1,a=0>b?-1:this.intParameter(a),e=new java.util.Hashtable,e.put("fileName","\u0001\u0001"+c),e.put("backgroundColor",Integer.$valueOf(this.vwr.getBackgroundArgb())),e.put("type",
"png"),e.put("quality",Integer.$valueOf(-1)),e.put("width",Integer.$valueOf(b)),e.put("height",Integer.$valueOf(a)),this.chk||this.vwr.processWriteOrCapture(e);else{if(e)switch(this.slen){case 2:b="closeall";break;case 3:case 4:break;default:this.checkLength(0)}this.chk||this.vwr.fm.loadImage(e?"\u0001close":b,"\u0001"+b+"\u0001"+("".equals(c)||null==c?null:c),!1)}});l(c$,"invertSelected",function(){var a=this.e,c=null,b=null,e=null,f=-2147483648,d=1;switch(this.tokAt(1)){case 0:if(this.chk)return;
e=this.vwr.bsA();c=this.vwr.ms.getAtomSetCenter(e);this.vwr.invertAtomCoord(c,null,e,-1,!1);return;case 528443:case 1140850689:d++;case 10:case 1073742325:case 12290:e=this.atomExpressionAt(d);if(!a.isAtomExpression(a.iToken+1)){a.checkLengthErrorPt(a.iToken+1,a.iToken+1);if(!this.chk)for(a=e.nextSetBit(0);0<=a;a=e.nextSetBit(a+1))this.vwr.invertAtomCoord(null,null,e,a,!1);return}f=e.nextSetBit(0);e=this.atomExpressionAt(a.iToken+1);break;case 134217751:c=a.centerParameter(2,null);break;case 134217750:b=
a.planeParameter(1,!1);break;case 134219777:b=a.hklParameter(2,null,!0)}a.checkLengthErrorPt(a.iToken+1,1);null==b&&(null==c&&-2147483648==f)&&this.invArg();this.chk||-1!=f&&this.vwr.invertSelected(c,b,f,e)});l(c$,"mapProperty",function(){for(var a,c,b,e,f,d=0,j=0,h=0,g=this.e;;){if(1113589787==this.tokAt(1))a=this.vwr.bsA(),c=this.atomExpressionAt(2),b=e="selected";else{a=this.atomExpressionAt(1);if(1073742336!=this.tokAt(++g.iToken)||!JS.T.tokAttr(d=this.tokAt(++g.iToken),1077936128))break;b=this.paramAsStr(g.iToken);
c=this.atomExpressionAt(++g.iToken);if(1073742336!=this.tokAt(++g.iToken)||!JS.T.tokAttr(j=this.tokAt(++g.iToken),2048))break;e=this.paramAsStr(g.iToken)}f=JS.T.tokAttr(h=this.tokAt(g.iToken+1),1077936128)?this.paramAsStr(++g.iToken):JS.T.nameOf(h=1094715393);g.checkLast(g.iToken);if(this.chk)return;var n=null;this.showString("mapping "+b.toUpperCase()+" for "+a.cardinality()+" atoms to "+e.toUpperCase()+" for "+c.cardinality()+" atoms using "+f.toUpperCase());if(JS.T.tokAttrOr(d,1094713344,1111490560)&&
JS.T.tokAttrOr(j,1094713344,1111490560)&&JS.T.tokAttrOr(h,1094713344,1111490560)){var m=this.getBitsetPropertyFloat(a,d|224,null,NaN,NaN),r=this.getBitsetPropertyFloat(a,h|224,null,NaN,NaN),d=this.getBitsetPropertyFloat(c,h|224,null,NaN,NaN),t=1715472409==j,k=O(t?this.vwr.ms.ac:d.length,0),n=new JU.BS;if(m.length==r.length){for(var q=new java.util.Hashtable,h=0;h<m.length;h++)q.put(Float.$valueOf(r[h]),Float.$valueOf(m[h]));m=-1;for(h=r=0;h<d.length;h++){var m=c.nextSetBit(m+1),l=q.get(Float.$valueOf(d[h]));
null!=l&&(n.set(m),k[t?m:r]=l.floatValue(),r++)}t?this.vwr.setData(e,B(-1,[e,k,n,Integer.$valueOf(1),Boolean.TRUE]),this.vwr.ms.ac,0,0,2147483647,0):JS.T.tokAttr(j,2048)?this.vwr.setAtomProperty(n,j,0,0,null,k,null):this.error(56)}}if(null==n){b=this.getBitsetIdent(a,"{"+f+"=%["+f+"]}."+e+" = %["+b+"]",null,!1,2147483647,!1);a=new JU.SB;for(h=0;h<b.length;h++)0>b[h].indexOf("null")&&a.append(b[h]).appendC("\n");JU.Logger.debugging&&JU.Logger.debug(a.toString());b=JU.BSUtil.copy(this.vwr.slm.bsSubset);
this.vwr.slm.setSelectionSubset(c);try{g.runScript(a.toString())}catch(w){if(P(w,Exception))c=w,this.vwr.slm.setSelectionSubset(b),g.errorStr(-1,"Error: "+c.getMessage());else if(P(w,Error))c=w,this.vwr.slm.setSelectionSubset(b),g.errorStr(-1,"Error: "+c.toString());else throw w;}this.vwr.slm.setSelectionSubset(b)}this.showString("DONE");return}this.invArg()});l(c$,"minimize",function(){for(var a=null,c=2147483647,b=0,e=!1,f=!1,d=null,j=!1,h=this.vwr.getMinimizer(!1),g=1;g<this.slen;g++)switch(this.getToken(g).tok){case 1073741828:e=
!0;continue;case 1073741874:case 1073742162:this.checkLength(2);if(this.chk||null==h)return;h.setProperty(this.paramAsStr(g),null);return;case 1073741882:this.checkLength(2);if(this.chk||null==h)return;h.setProperty("clear",null);return;case 1073741894:1!=g&&this.invArg();c=a=0;b=I(5,0);if(1073741882==this.tokAt(++g))this.checkLength(3);else{for(;4>a&&!this.isFloatParameter(g);)b[++a]=this.atomExpressionAt(g).nextSetBit(0),g=this.e.iToken+1;b[0]=a;1==a&&this.invArg();c=this.floatParameter(this.e.checkLast(g))}this.chk||
this.vwr.getMinimizer(!0).setProperty("constraint",B(-1,[b,Float.$valueOf(c)]));return;case 1073741905:b=this.floatParameter(++g);continue;case 1073741935:c=0;continue;case 12293:1!=g&&this.invArg();d=this.atomExpressionAt(++g);0>d.nextSetBit(0)&&(d=null);g=this.e.iToken;this.chk||this.vwr.getMinimizer(!0).setProperty("fixed",d);if(g+1==this.slen)return;continue;case 10:case 1073742325:j=!0;case 1275082245:1275082245==this.e.theTok&&g++;a=this.atomExpressionAt(g);g=this.e.iToken;1073742072==this.tokAt(g+
1)&&(g++,j=!0);continue;case 1073742148:f=!0;break;case 266298:c=this.intParameter(++g);continue;default:this.invArg()}if(!this.chk)try{this.vwr.minimize(this.e,c,b,a,d,0,(e?8:0)|(j?16:0)|(f?1:0))}catch(n){if(P(n,Exception))throw new JS.ScriptInterruption(this.e,"minimize",1);throw n;}});l(c$,"modulation",function(){var a=null,c=this.e,b=!0,e=!1,f=null,d=1;switch(this.getToken(d).tok){case 1073742334:b=!1;case 0:case 1073742335:break;case 12290:case 10:case 1073742325:f=this.atomExpressionAt(1);switch(this.tokAt(c.iToken+
1)){case 1073742334:b=!1;case 1073742335:c.iToken++}c.checkLast(c.iToken);break;case 1073742332:case 8:a=c.getPoint3f(1,!1,!0);e=1073742335==this.tokAt(c.iToken+1);break;default:var j=c.theToken.value.toString();d++;j.equalsIgnoreCase("t")?c.theTok=3:j.equalsIgnoreCase("m")||j.equalsIgnoreCase("q")?c.theTok=2:this.invArg();case 3:case 2:switch(c.theTok){case 3:this.isFloatParameter(d)?(a=this.floatParameter(d),a=JU.P3.new3(a,a,a)):a=c.getPoint3f(d,!1,!0);break;case 2:2==this.tokAt(d)?(e=this.intParameter(d),
a=JU.P3.new3(e,e,e)):a=c.getPoint3f(d,!1,!0),e=!0}break;case 536875009:b=this.floatParameter(2);this.chk||this.vwr.setFloatProperty("modulationScale",b);return}this.chk||(this.vwr.tm.setVibrationPeriod(0),this.vwr.setModulation(f,b,a,e))});l(c$,"mutate",function(){var a=this.e.iToken,c,b=null,e=null,f=null,d=!1;switch(this.tokAt(++a)){case 1073741904:b="alpha";d=!0;c=null;switch(this.tokAt(++a)){case 0:this.invArg();break;default:switch(e=this.e.paramAsStr(a),a=this.e.iToken,this.tokAt(a+1)){case 0:break;
case 268435520:case 1073742195:case 7:b=null;f=this.e.floatParameterSet(++a,2,2147483647);1==f.length%2&&this.invArg();a=this.e.iToken;break;default:b=this.e.paramAsStr(++a),a=this.e.iToken}}break;case 2:this.st[1]=JS.T.o(4,""+this.st[1].value);default:c=this.atomExpressionAt(a);a=++this.e.iToken;break;case 268435633:c=this.vwr.getFrameAtoms(),a=++this.e.iToken}if(!this.chk&&null!=c){c.and(this.vwr.getFrameAtoms());var j=c.nextSetBit(0);0>j&&this.invArg();j=this.vwr.ms.at[j].mi;if(this.vwr.ms.isTrajectory(j)||
!this.vwr.ms.am[j].isBioModel)return}null==e&&(e=this.e.optParameterAsString(a));this.e.checkLast(a);if(!this.chk){a=e.startsWith("~");if(!a&&!d&&(0<=e.indexOf(".")||0>e.indexOf("-")))d=B(-1,[e]),e=null;else if(e=JU.PT.replaceAllCharacters(e,",; \t\n"," ").trim().toUpperCase(),!a&&0<=e.indexOf("-"))d=JU.PT.split(e,"-");else{if(a||3!=e.length||!this.vwr.getJBR().isKnownPDBGroup(e,20))e=this.vwr.getJBR().toStdAmino3(a?e.substring(1):e);d=JU.PT.getTokens(e)}this.e.iToken=this.e.slen;0<d.length&&!this.vwr.getJBR().getBioModelSet(this.vwr.ms).mutate(c,
e,d,b,f)&&this.invArg()}});l(c$,"navigate",function(){var a=this.e;if(1==this.slen)a.setBooleanProperty("navigationMode",!0);else{var c=JU.V3.new3(0,1,0),b=new JU.Lst,e;if(2==this.slen)switch(this.getToken(1).tok){case 1073742335:case 1073742334:if(this.chk)return;a.setObjectMad10(34,"axes",10);this.setShapeProperty(34,"position",JU.P3.new3(50,50,3.4028235E38));a.setBooleanProperty("navigationMode",!0);this.vwr.tm.setNavOn(1073742335==a.theTok);return;case 1073742162:this.chk||this.vwr.tm.setNavXYZ(0,
0,0);return;case 8:case 1112152078:break;default:this.invArg()}!this.chk&&!this.vwr.getBoolean(603979889)&&a.setBooleanProperty("navigationMode",!0);for(var f=1;f<this.slen;f++){var d=this.isFloatParameter(f)?this.floatParameter(f++):2;0>d&&this.invArg();!this.chk&&0<d&&a.refresh(!1);switch(this.getToken(f).tok){case 8:case 1073742332:e=this.getPoint3f(f,!0);a.iToken++;a.iToken!=this.slen&&this.invArg();this.chk||this.vwr.tm.setNavXYZ(e.x,e.y,e.z);return;case 554176526:e=this.floatParameter(++f);
this.chk||b.addLast(B(-1,[Integer.$valueOf(554176526),Float.$valueOf(d),Float.$valueOf(e)]));continue;case 12289:e=this.centerParameter(++f);f=a.iToken;this.chk||b.addLast(B(-1,[Integer.$valueOf(134217751),Float.$valueOf(d),e]));continue;case 528432:switch(this.getToken(++f).tok){case 1111492629:c.set(1,0,0);f++;break;case 1111492630:c.set(0,1,0);f++;break;case 1111492631:c.set(0,0,1);f++;break;case 8:case 1073742332:c.setT(this.getPoint3f(f,!0));f=a.iToken+1;break;case 1073741824:this.invArg()}e=
this.floatParameter(f);this.chk||b.addLast(B(-1,[Integer.$valueOf(528432),Float.$valueOf(d),c,Float.$valueOf(e)]));continue;case 4160:var j=e=NaN;if(this.isFloatParameter(++f))e=this.floatParameter(f),j=this.floatParameter(++f);else switch(this.tokAt(f)){case 1111492629:e=this.floatParameter(++f);break;case 1111492630:j=this.floatParameter(++f);break;default:e=this.centerParameter(f);f=a.iToken;this.chk||b.addLast(B(-1,[Integer.$valueOf(4160),Float.$valueOf(d),e]));continue}this.chk||b.addLast(B(-1,
[Integer.$valueOf(268435634),Float.$valueOf(d),Float.$valueOf(e),Float.$valueOf(j)]));continue;case 268435632:continue;case 1112152078:e=new JU.Lst;a.isAtomExpression(f+1)?(j=this.atomExpressionAt(++f),f=a.iToken):j=this.vwr.bsA();if(this.chk)return;this.vwr.getPolymerPointsAndVectors(j,e);var h;if(0<(h=e.size())){for(var j=Array(h),g=0;g<h;g++)j[g]=e.get(g);b.addLast(B(-1,[Integer.$valueOf(1112152078),Float.$valueOf(d),j]));continue}break;case 1073742084:if(1073742330==this.getToken(f+1).tok){f++;
e=a.objectNameParameter(++f);if(this.chk)return;this.setShapeProperty(22,"thisID",e);e=this.getShapeProperty(22,"vertices");a.refresh(!1);null==e&&this.invArg();j=A(this.isFloatParameter(f+1)?this.floatParameter(++f):0);h=A(this.isFloatParameter(f+1)?this.floatParameter(++f):2147483647);b.addLast(B(-1,[Integer.$valueOf(1073742084),Float.$valueOf(d),e,null,I(-1,[j,h])]));continue}for(e=new JU.Lst;a.isCenterParameter(f+1);)e.addLast(this.centerParameter(++f)),f=a.iToken;if(0<e.size()){e=e.toArray(Array(e.size()));
this.chk||b.addLast(B(-1,[Integer.$valueOf(1073742084),Float.$valueOf(d),e,null,I(-1,[0,2147483647])]));continue}default:this.invArg()}}!this.chk&&!this.vwr.isJmolDataFrame()&&this.vwr.tm.navigateList(a,b)}});l(c$,"plot",function(a){var c=this.e,b=this.vwr.am.cmi;0>b&&c.errorStr(30,"plot");var b=this.vwr.ms.getJmolDataSourceFrame(b),e=a.length-1,f=a!==this.st,d=!0,j=this.st;f&&(c.st=this.st=a);var h=f?134222350:a[0].tok,g=f||134221850==h||4138==h?0:1,n=null,m=!0,r=!1;switch(h){case 135176:m=!1;r=
!0;break;case 134222350:d=m=!1;break;case 134221856:m=!1,4==JS.CmdExt.tokAtArray(e,a)?n=this.stringParameter(e--):1073742336==JS.CmdExt.tokAtArray(e-1,a)?(n=this.paramAsStr(e-2)+"."+this.paramAsStr(e),e-=3):(c.st=this.st=j,c.iToken=this.st.length,this.error(13)),c.slen=this.slen=e+1}var f="",t=null,k="",q=!1,l=!1,w=!1,u=!1,p=Array(3),s=I(3,0),A=JU.BSUtil.copy(this.vwr.bsA()),K="; select "+JU.Escape.eBS(A)+";\n ",u=c.optParameterAsString(e).toLowerCase(),D=null,G=null,y=null,F=JS.CmdExt.tokAtArray(g,
a);4==F&&(F=JS.T.getTokFromName(a[g].value));switch(F){default:c.iToken=1;this.invArg();break;case 134221834:c.iToken=1;u="data";K="";break;case 1715472409:c.iToken=g+1;for(a=0;3>a;a++){switch(this.tokAt(c.iToken)){case 4:s[a]=JS.T.getTokFromName(c.getToken(c.iToken).value);break;default:s[a]=this.tokAt(c.iToken);break;case 0:0==a&&this.invArg();case 1287653388:case 32:case 64:a=2;continue}1715472409!=s[a]&&!JS.T.tokAttr(s[a],1077936128)&&this.invArg();p[a]=this.getToken(c.iToken).value.toString();
c.iToken++}1287653388==this.tokAt(c.iToken)&&(y=this.stringParameter(++c.iToken),d=!1,c.iToken++);32==this.tokAt(c.iToken)&&(D=this.getPoint3f(++c.iToken,!1),c.iToken++);64==this.tokAt(c.iToken)&&(G=this.getPoint3f(++c.iToken,!1),c.iToken++);u="property "+p[0]+(null==p[1]?"":" "+p[1])+(null==p[2]?"":" "+p[2]);0>A.nextSetBit(0)&&(A=this.vwr.getModelUndeletedAtomsBitSet(b));k="select "+JU.Escape.eBS(A)+";\n ";break;case 4138:u.equalsIgnoreCase("draw")&&(u=c.optParameterAsString(--e).toLowerCase());
u=e>g&&u.startsWith("r");u="ramachandran"+(u?" r":"")+(135176==h?" draw":"");break;case 134221850:case 136314895:f=' "'+this.vwr.getQuaternionFrame()+'"';k="set quaternionFrame"+f+";\n  ";q=!0;u.equalsIgnoreCase("draw")&&(r=!0,u=c.optParameterAsString(--e).toLowerCase());w=(l=u.startsWith("deriv")||u.startsWith("diff"))&&0<u.indexOf("2");l&&e--;if(u.equalsIgnoreCase("helix")||u.equalsIgnoreCase("axis"))l=r=!0,e=-1;u=((e<=g?"":c.optParameterAsString(e))+"w").substring(0,1);if(u.equals("a")||u.equals("r"))l=
!0;JU.PT.isOneOf(u,";w;x;y;z;r;a;")||c.evalError("QUATERNION [w,x,y,z,a,r] [difference][2]",null);u="quaternion "+u+(l?" difference":"")+(w?"2":"")+(r?" draw":"")}this.st=j;if(this.chk)return"";if(m&&(k+="plot "+u,j=this.vwr.ms.getJmolDataFrameIndex(b,k),0<j&&134221856!=h&&134222350!=h))return this.vwr.setCurrentModelIndexClear(j,!0),"";m=e=j=null;g=Array(3);if(1715472409==F){j=this.getBitsetPropertyFloat(A,s[0]|224,1715472409==s[0]?p[0]:null,null==D?NaN:D.x,null==G?NaN:G.x);g[0]=p[0]+" "+JU.Escape.eAF(j);
null!=p[1]&&(e=this.getBitsetPropertyFloat(A,s[1]|224,1715472409==s[1]?p[1]:null,null==D?NaN:D.y,null==G?NaN:G.y),g[1]=p[1]+" "+JU.Escape.eAF(e));null!=p[2]&&(m=this.getBitsetPropertyFloat(A,s[2]|224,1715472409==s[2]?p[2]:null,null==D?NaN:D.z,null==G?NaN:G.z),g[2]=p[2]+" "+JU.Escape.eAF(m));null==D&&(D=JU.P3.new3(this.getPlotMinMax(j,!1,s[0]),this.getPlotMinMax(e,!1,s[1]),this.getPlotMinMax(m,!1,s[2])));null==G&&(G=JU.P3.new3(this.getPlotMinMax(j,!0,s[0]),this.getPlotMinMax(e,!0,s[1]),this.getPlotMinMax(m,
!0,s[2])));JU.Logger.info("plot min/max: "+D+" "+G);r=t=null;if(d){r=JU.P3.new3(1,1,1);t=new JU.P3;t.ave(G,D);r.sub2(G,D);r.set(r.x/200,r.y/200,r.z/200);JS.T.tokAttr(s[0],1094713344)?(r.x=1,t.x=0):0.1<r.x&&10>=r.x&&(r.x=1);JS.T.tokAttr(s[1],1094713344)?(r.y=1,t.y=0):0.1<r.y&&10>=r.y&&(r.y=1);JS.T.tokAttr(s[2],1094713344)?(r.z=1,t.z=0):0.1<r.z&&10>=r.z&&(r.z=1);if(null==p[2]||null==p[1])t.z=D.z=G.z=r.z=0;for(a=0;a<j.length;a++)j[a]=(j[a]-t.x)/r.x;if(null!=p[1])for(a=0;a<e.length;a++)e[a]=(e[a]-t.y)/
r.y;if(null!=p[2])for(a=0;a<m.length;a++)m[a]=(m[a]-t.z)/r.z}t=B(-1,[A,j,e,m,D,G,r,t,y,g])}if(134221856==h)return this.vwr.writeFileData(n,"PLOT_"+u,b,t);d=u.equals("data")?"1 0 H 0 0 0 # Jmol PDB-encoded data":this.vwr.getPdbData(b,u,null,t,null,!0);if(134222350==h)return d;JU.Logger.debugging&&JU.Logger.debug(d);if(135176==h)return c.runScript(d),"";h=this.vwr.fm.getFileInfo();n=this.vwr.getBoolean(603979792);this.vwr.g.appendNew=!0;d=null!=d&&null==this.vwr.openStringInlineParamsAppend(d,null,
!0);this.vwr.g.appendNew=n;this.vwr.fm.setFileInfo(h);if(!d)return"";h=this.vwr.ms.mc;this.vwr.ms.setJmolDataFrame(k,b,h-1);1715472409!=F&&(k+=";\n"+K);k=this.vwr.addStateScript(k,!0,!1);d=150;switch(F){default:b="frame 0.0; frame last; reset;select visible;wireframe only;";d=10;break;case 1715472409:this.vwr.setFrameTitle(h-1,u+" plot for model "+this.vwr.getModelNumberDotted(b));b="frame 0.0; frame last; reset;select visible; spacefill 3.0; wireframe 0;draw plotAxisX"+h+' {100 -100 -100} {-100 -100 -100} "'+
p[0]+'";draw plotAxisY'+h+' {-100 100 -100} {-100 -100 -100} "'+p[1]+'";';null!=p[2]&&(b+="draw plotAxisZ"+h+' {-100 -100 100} {-100 -100 -100} "'+p[2]+'";');break;case 4138:this.vwr.setFrameTitle(h-1,"ramachandran plot for model "+this.vwr.getModelNumberDotted(b));b="frame 0.0; frame last; reset;select visible; color structure; spacefill 3.0; wireframe 0;draw ramaAxisX"+h+' {100 0 0} {-100 0 0} "phi";draw ramaAxisY'+h+' {0 100 0} {0 -100 0} "psi";';break;case 134221850:case 136314895:this.vwr.setFrameTitle(h-
1,u.$replace("w"," ")+f+" for model "+this.vwr.getModelNumberDotted(b)),b=JU.C.getHexCode(this.vwr.cm.colixBackgroundContrast),b="frame 0.0; frame last; reset;select visible; wireframe 0; spacefill 3.0; isosurface quatSphere"+h+" color "+b+" sphere 100.0 mesh nofill frontonly translucent 0.8;draw quatAxis"+h+'X {100 0 0} {-100 0 0} color red "x";draw quatAxis'+h+'Y {0 100 0} {0 -100 0} color green "y";draw quatAxis'+h+'Z {0 0 100} {0 0 -100} color blue "z";color structure;draw quatCenter'+h+"{0 0 0} scale 0.02;"}c.runScript(b+
K);k.setModelIndex(this.vwr.am.cmi);this.vwr.setRotationRadius(d,!0);c.sm.loadShape(31);this.showString("frame "+this.vwr.getModelNumberDotted(h-1)+(0<u.length?" created: "+u+(q?f:""):""));return""},"~A");l(c$,"polyhedra",function(){var a=this.e,c=1==this.slen,b=!1,e=c,f=!1,d=!1,j=!1,h=NaN,g=0;a.sm.loadShape(21);this.setShapeProperty(21,"init",Boolean.TRUE);for(var n=3.4028235E38,m=-1,r=I(-1,[-2147483648]),t=-1,k=null,q=null,l=!1,w=null,u=null,p=1;p<this.slen;++p){var s=null,w=null;switch(this.getToken(p).tok){case 1073742197:h=
NaN;case 1073741872:a=1073742197==this.e.theTok?-1:2==this.tokAt(p+1)?this.intParameter(++p):1;this.chk||J.api.Interface.getInterface("JU.BZone",this.vwr,"script").setViewer(this.vwr).createBZ(a,null,!1,q,h);this.setShapeProperty(21,"init",Boolean.FALSE);return;case 6:s="info";w=this.e.theToken.value;e=!0;break;case 134217751:s="points";w=Float.$valueOf(1073742334==this.tokAt(++p)?0:this.e.floatParameter(p));l=!0;break;case 536875009:h=this.floatParameter(++p);l=!0;continue;case 1814695966:null!=
q&&this.invArg();s="unitCell";w=Boolean.TRUE;e=!0;break;case 1073742072:this.e.restrictSelected(!1,!1),a.theTok=1073742335;case 1073742335:case 12291:case 1073742334:(p+1!=this.slen||e||1<g)&&this.error(18);s=1073742334==a.theTok?"off":1073742335==a.theTok?"on":"delete";f=!0;break;case 7:(null==q||e)&&this.invArg();e=!0;w=this.getIntArray2(p);u=this.getAllPoints(a.iToken+1,3);p=a.iToken;M(u[0],JM.Atom)&&this.setShapeProperty(21,"model",Integer.$valueOf(u[0].getModelIndex()));s="definedFaces";w=B(-1,
[w,u]);break;case 1073741961:s="full";break;case 2:null!=q&&this.invArg();s="nVertices";w=Integer.$valueOf(this.intParameter(p));e=!0;268435504==this.tokAt(p+1)&&p++;break;case 1677721602:null!=q&&this.invArg();0<g&&this.invPO();e=!0;s="bonds";c=!0;break;case 1073741852:-1!=m&&this.invArg(),m=0,p--;case 1665140738:p++;case 3:null!=q&&this.invArg();0<g&&this.invPO();s=0>=m?"radius":"radius1";w=Float.$valueOf(m=0==m?0:this.floatParameter(p));e=!0;break;case 1073742066:if(!this.isFloatParameter(p+1)){k=
this.e.centerParameter(++p,null);p=a.iToken;l=!0;continue}case 1073741937:this.setShapeProperty(21,"collapsed",null);case 1073742099:case 1073741924:s=JS.T.nameOf(a.theTok);switch(this.tokAt(p+1)){case 268435860:case 268435504:p++}w=Float.$valueOf(this.floatParameter(++p));break;case 1094717454:null==q&&this.invArg();s="model";w=Integer.$valueOf(this.intParameter(++p));break;case 1073742170:(1<g||null!=q&&!b||t==p)&&this.invPO();g=3;a.isAtomExpression(++p)?(s=e||b?"to":"toBitSet",w=this.atomExpressionAt(p)):
a.isArrayParameter(p)?(s="toVertices",w=a.getPointArray(p,-1,!1)):this.error(19);p=a.iToken;e=!0;break;case 12290:case 10:case 1073742325:d&&this.invPO();switch(++g){case 1:null!=q&&this.invArg();s="centers";break;case 2:s="to";e=!0;break;default:a.bad()}w=this.atomExpressionAt(p);p=a.iToken;e=(new Boolean(e|p+1==this.slen)).valueOf();break;case 1765808134:case 603979967:case 1073742074:n=this.getColorTrans(a,p,!0,r);p=a.iToken;continue;case 1073741948:case 1073741886:d&&this.error(18);d=!0;s=1073741886==
this.e.theTok?"collapsed":null;e&&this.isFloatParameter(p+1)&&this.setShapeProperty(21,"faceCenterOffset",Float.$valueOf(this.floatParameter(++p)));break;case 1073742044:case 1073741933:case 1073741956:case 1073741934:j&&this.error(18);l=j=!0;s=JS.T.nameOf(a.theTok);break;case 1073742182:case 1073742060:case 1073741861:case 1073741958:case 1073741964:continue;case 1073741974:case 268435633:case 1073741824:case 4:if(!a.isColorParam(p)){1!=p&&this.invPO();q=1073741974==a.theTok?this.stringParameter(++p):
a.optParameterAsString(p);this.setShapeProperty(21,"thisID",q);this.setShapeProperty(21,"model",Integer.$valueOf(this.vwr.am.cmi));if(!a.isCenterParameter(p+1))continue;s="center";w=this.centerParameter(++p);p=a.iToken;b=!0;break}default:if(a.isColorParam(p)){r[0]=a.getArgbParam(p);a.isCenterParameter(p)&&(t=a.iToken+1);p=a.iToken;continue}this.invArg()}null!=s&&this.setShapeProperty(21,s,w);if(f)return}e?(!d&&c&&this.setShapeProperty(21,"bonds",null),this.setShapeProperty(21,"generate",null)):l||
this.error(19);null!=k&&this.setShapeProperty(21,"offset",k);Float.isNaN(h)||this.setShapeProperty(21,"scale",Float.$valueOf(h));-2147483648!=r[0]&&this.setShapeProperty(21,"colorThis",Integer.$valueOf(r[0]));3.4028235E38!=n&&a.setShapeTranslucency(21,"","translucentThis",n,null);this.setShapeProperty(21,"init",Boolean.FALSE)});l(c$,"write",function(a){var c=this.e,b=1,e=1,f=null,d=null,j=null,h=null,g="SPT",n=!0,m=!1,r=!1;null==a?(a=this.st,m=this.vwr.isApplet&&!this.vwr.isSignedApplet||!this.vwr.haveAccess(JV.Viewer.ACCESS.ALL)||
0<this.vwr.fm.getPathForAllFiles().length):(b=e=0,n=!1,m=!n);var l=JS.CmdExt.tokAtArray(b,a);if(4==l&&!n){var k=JS.T.getTokenFromName(JS.SV.sValue(a[0]).toLowerCase());null!=k&&(l=k.tok)}switch(l){case 0:break;case 134221850:case 4138:case 1715472409:return d=this.plot(a),m?d:this.writeMsg(d);case 134222850:c.isArrayParameter(b+1)&&(f=c.stringParameterSet(++b),h=j=".",e=b=c.iToken+1,l=this.tokAt(b));break;default:g=JS.SV.sValue(this.tokenAt(b,a)).toUpperCase()}var q=this.vwr.getExportDriverList(),
k=null,v=n?this.slen:a.length,w="",u=null,p=!1,s=null,A=0,B=null,D=!1,G=null,y=-1,F=-1,C=!1,x=null,E=-2147483648;0!=l&&(n&&1<this.slen&&1073741848==this.tokAt(this.slen-2))&&(g=this.paramAsStr(this.slen-1).toUpperCase(),e=v,v-=2,l=0);switch(l){case 15:case 6:g="VAR";s=this.tokenAt(b++,a);break;case 1073741984:g="INLINE";k=JS.SV.sValue(this.tokenAt(++b,a));b++;break;case 1275068447:g="PGRP";b++;w=JS.SV.sValue(this.tokenAt(b,a)).toLowerCase();w.equals("draw")&&b++;break;case 1073742329:b++;D=!0;break;
case 1073742158:case 134222850:for(u=JS.SV.sValue(this.tokenAt(++b,a)).toLowerCase();u.equals("localpath")||u.equals("remotepath");)u.equals("localpath")?j=JS.SV.sValue(this.tokenAt(++b,a)):h=JS.SV.sValue(this.tokenAt(++b,a)),u=JS.SV.sValue(this.tokenAt(++b,a)).toLowerCase();g="SPT";break;case 1228935687:case 134320141:case 1610616855:case 135180:case 1073742015:case 1073742018:case 1073877011:case 1073877010:case 135188:b++;break;case 1073741991:g="ZIPALL";b++;break;case 36868:g="VAR";b+=2;break;
case 1073741929:case 4115:case 4120:case 1073742062:case 1073742139:case 4166:case 1073741824:case 4:switch(l){case 4115:b+1<v&&1073742325==a[++b].tok||10==a[b].tok?(u=c.atomExpression(a,b,0,!0,!1,null,!0),b=c.iToken+1):u=this.vwr.getAllAtoms();this.chk||(G=this.vwr.ms.getModelBS(u,!0));break;case 1073741929:l=4120,p=!0;case 4120:g="IMAGE";b++;break;case 1073742139:u=JS.SV.sValue(this.tokenAt(++b,a)).toUpperCase();JU.PT.isOneOf(u,";PNG;PNGJ;")?(B=u,b++):B="PNG";break;case 4166:A=c.intParameterRange(++b,
1,10);if(2147483647==A)return"";this.chk||(this.vwr.tm.setVibrationPeriod(0),c.isJS||c.delayScript(100));b++;break;default:l=4120}if(4120==l&&b<a.length)if(l=JS.T.getTokenFromName(JS.SV.sValue(a[b]).toLowerCase()),null!=l&&(g=JS.SV.sValue(l).toUpperCase()),JU.PT.isOneOf(g,q.toUpperCase())){b++;g=g.substring(0,1).toUpperCase()+g.substring(1).toLowerCase();C=!0;n&&(x="Jmol."+g.toLowerCase());break}else if(JU.PT.isOneOf(g,";ZIP;ZIPALL;SPT;STATE;")){b++;break}else g="IMAGE";2==JS.CmdExt.tokAtArray(b,
a)&&(y=JS.SV.iValue(this.tokenAt(b++,a)),0>=y&&this.invArg(),F=JS.SV.iValue(this.tokenAt(b++,a)),0>=F&&this.invArg())}if(e<v){u=JS.SV.sValue(this.tokenAt(b,a));if(u.equalsIgnoreCase("clipboard")){if(this.chk)return""}else JU.PT.isOneOf(u.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;")?(2==JS.CmdExt.tokAtArray(b+1,a)&&2==JS.CmdExt.tokAtArray(b+2,a)&&(y=JS.SV.iValue(this.tokenAt(++b,a)),0>=y&&this.invArg(),F=JS.SV.iValue(this.tokenAt(++b,a)),0>=F&&this.invArg()),2==JS.CmdExt.tokAtArray(b+
1,a)&&(E=JS.SV.iValue(this.tokenAt(++b,a)))):JU.PT.isOneOf(u.toLowerCase(),";xyz;xyzrn;xyzvib;mol;mol67;sdf;v2000;v3000;json;pdb;pqr;cml;cif;cifp1;pwmat;pwslab;qcjson;xsf;")&&(g=u.toUpperCase(),b+1==v&&b++);g.equals("IMAGE")&&JU.PT.isOneOf(u.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;scene;")&&(g=u.toUpperCase(),E=-2147483648,b++)}b+2==v&&JS.SV.sValue(this.tokenAt(++b,a));switch(JS.CmdExt.tokAtArray(b,a)){case 0:m=!0;break;case 1073741884:break;case 805306401:x=g.equals("IMAGE")?
"?jmol.png":"?jmol."+g.toLowerCase();break;case 1073741824:case 4:x=JS.SV.sValue(this.tokenAt(b,a));if(x.equalsIgnoreCase("clipboard")||!this.vwr.haveAccess(JV.Viewer.ACCESS.ALL))x=null;break;default:this.invArg()}if(g.equals("IMAGE")||g.equals("FRAME")||g.equals("VIBRATION"))g=null!=x&&0<=x.indexOf(".")?x.substring(x.lastIndexOf(".")+1).toUpperCase():"JPG";if(g.equals("ISOSURFACE")||g.equals("CONTACT"))r=g.equals("CONTACT"),g=null!=x&&0<=x.indexOf(".")?x.substring(x.lastIndexOf(".")+1).toUpperCase():
"JVXL",g.equals("PMESH")?g="ISOMESH":g.equals("PMB")&&(g="ISOMESHBIN");l=JU.PT.isOneOf(g.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;scene;");if(!l&&(g.equals("MNU")?g="MENU":g.equals("WRL")||g.equals("VRML")?(g="Vrml",C=!0):g.equals("X3D")?(g="X3d",C=!0):g.equals("STL")?(g="Stl",C=!0):g.equals("IDTF")?(g="Idtf",C=!0):g.equals("MA")?(g="Maya",C=!0):g.equals("JS")?(g="Js",C=!0):g.equals("OBJ")?(g="Obj",C=!0):g.equals("JVXL")?g="ISOSURFACE":g.equals("XJVXL")?g="ISOSURFACE":
g.equals("JMOL")?g="ZIPALL":g.equals("HIS")&&(g="HISTORY"),g.equals("COORD")||g.equals("COORDS")))g=null!=x&&0<=x.indexOf(".")?x.substring(x.lastIndexOf(".")+1).toUpperCase():"XYZ";null!=f&&(JV.FileManager.isJmolType(g)||this.invArg(),g.equals("PNG")&&(g="PNGJ"));!l&&(!C&&!JU.PT.isOneOf(g,";SCENE;JMOL;ZIP;ZIPALL;SPT;HISTORY;MO;NBO;ISOSURFACE;MESH;PMESH;PMB;ISOMESHBIN;ISOMESH;VAR;FILE;FUNCTION;CFI;CIF;CIFP1;CML;JSON;XYZ;XYZRN;XYZVIB;MENU;MOL;MOL67;PDB;PGRP;PQR;PWMAT;PWSLAB;QUAT;RAMA;SDF;V2000;V3000;QCJSON;XSF;INLINE;"))&&
c.errorStr2(54,"COORDS|FILE|FUNCTIONS|HISTORY|IMAGE|INLINE|ISOSURFACE|JMOL|MENU|MO|NBO|POINTGROUP|QUATERNION [w,x,y,z] [derivative]|RAMACHANDRAN|SPT|STATE|VAR x|ZIP|ZIPALL|CLIPBOARD","CIF|CIFP1|CML|CFI|GIF|GIFT|JPG|JPG64|JMOL|JVXL|MESH|MOL|PDB|PMESH|PNG|PNGJ|PNGT|PPM|PQR|PWMAT|PWSLAB|SDF|CD|JSON|QCJSON|V2000|V3000|SPT|XJVXL|XSF|XYZ|XYZRN|XYZVIB|ZIP"+q.toUpperCase().$replace(";","|"));if(this.chk)return"";var b=Array(1),z,e=this.vwr.getBoolean(603979934);if(C){e&&JU.Logger.startTimer("export");d=new java.util.Hashtable;
d.put("type",g);null!=x&&d.put("fileName",x);(n||null!=x)&&d.put("fullPath",b);d.put("width",Integer.$valueOf(y));d.put("height",Integer.$valueOf(F));k=this.vwr.generateOutputForExport(d);if(null==k||0==k.length)return"";if(m)return k;if(!g.equals("Povray")&&!g.equals("Idtf")||null==b[0])return this.writeMsg(k);d=g.equals("Idtf")?".tex":".ini";x=b[0]+d;z=new java.util.Hashtable;z.put("fileName",x);z.put("type",d);z.put("text",k);z.put("fullPath",b);d=this.vwr.processWriteOrCapture(z);g.equals("Idtf")&&
(k=k.substring(0,k.indexOf("\\begin{comment}")));k="Created "+b[0]+":\n\n"+k;e&&this.showString(JU.Logger.getTimerMsg("export",0));null!=d&&((g=!d.startsWith("OK"))&&c.evalError(d,null),c.report(k,g));return""}C=null;q=!1;if(null==k){v=0;k=g.intern();if("MENU"===k)k=this.vwr.getMenu("");else if("PGRP"===k)k=this.vwr.ms.getPointGroupAsString(this.vwr.bsA(),null,0,1,null,null,w.equals("draw")?"":null);else if("PDB"===k||"PQR"===k)m?k=this.vwr.getPdbAtomData(null,null,"PQR"===k,D):(q=!0,g="PDB_"+k+"-coord "+
D);else if("FILE"===k)"?".equals(x)&&(x="?Jmol."+this.vwr.getP("_fileType")),m?k=this.getCurrentModelFileAsString():q=!0;else if(JU.PT.isOneOf(k,";CIF;CIFP1;SDF;MOL;MOL67;V2000;V3000;CD;JSON;XYZ;XYZRN;XYZVIB;CML;QCJSON;PWMAT;PWSLAB;XSF;")){a=this.vwr.bsA();this.vwr.setErrorMessage(null," ("+a.cardinality()+" atoms)");k=this.vwr.getModelExtract(a,D,!1,k);d=this.vwr.getErrorMessageUn();this.vwr.setErrorMessage(null,null);if(0<=this.vwr.am.cmi&&!a.equals(z=this.vwr.getModelUndeletedAtomsBitSet(this.vwr.am.cmi)))d+=
"\nNote! Selected atom set "+a+" is not the same as the current model "+z;k.startsWith("ERROR:")&&(C=k)}else if("CFI"===k)k=this.vwr.getModelFileData("selected","cfi",!1);else if("FUNCTION"===k)k=this.vwr.getFunctionCalls(null),g="TXT";else if("VAR"===k)null==s&&(s=c.getParameter(JS.SV.sValue(this.tokenAt(n?2:1,a)),1073742190,!0)),a=null,15==s.tok?(a=new JU.Lst,a.addLast(s.value.data)):6==s.tok&&(a=null==x?new JU.Lst:this.prepareBinaryOutput(s)),null==a?(k=s.asString(),g="TXT"):null!=x&&(z=new java.util.Hashtable,
z.put("data",a),null==(C=k=this.vwr.createZip(x,1==a.size()||x.endsWith(".png")||x.endsWith(".pngj")?"BINARY":"ZIPDATA",z))&&c.evalError("#CANCELED#",null));else if("SPT"===k)if(D)z=this.vwr.ms.getTaintedAtoms(2),this.vwr.setAtomCoordsRelative(JU.P3.new3(0,0,0),null),k=this.vwr.getStateInfo(),this.vwr.ms.setTaintedAtoms(z,2);else{if(k=this.vwr.getStateInfo(),null!=j||null!=h)k=JV.FileManager.setScriptFileReferences(k,j,h,null)}else"ZIP"===k||"ZIPALL"===k?null!=x&&(z=new java.util.Hashtable,null!=
f&&z.put("data",f),null==(C=k=this.vwr.createZip(x,g,z))&&c.evalError("#CANCELED#",null)):"HISTORY"===k?(k=this.vwr.getSetHistory(2147483647),g="SPT"):"MO"===k||"NBO"===k?(k=this.getMoJvxl(2147483647,"NBO"===k),g="XJVXL"):"PMESH"===k||"PMB"===k?(null==(k=this.getIsosurfaceJvxl(29,k))&&this.error(31),g="XJVXL"):"ISOMESH"===k?(null==(k=this.getIsosurfaceJvxl(24,k))&&this.error(31),g="PMESH"):"ISOMESHBIN"===k?(null==(C=this.getIsosurfaceJvxl(24,"ISOMESHBIN"))&&this.error(31),g="PMB"):"ISOSURFACE"===
k||"MESH"===k?(null==(k=this.getIsosurfaceJvxl(r?25:24,k))&&this.error(31),g=0<=k.indexOf("<?xml")?"XJVXL":"JVXL",m||this.showString(this.getShapeProperty(r?25:24,"jvxlFileInfo"))):(n&&(m&&null==x)&&(m=!1,x="\u0001"),v=-1,null==B&&0>E&&(E=-1));null==k&&(k="");0==v&&(null==C||M(C,String))}if(!n)return k;if(m)return c.showStringPrint(k,!0),"";if(null!=C&&M(C,String))return this.writeMsg(C);if(q)return this.writeMsg(this.vwr.writeFileData(x,g,0,null));if(g.equals("SCENE"))C=B;else if(null==C&&(!l||null!=
x))C=k;e&&JU.Logger.startTimer("write");l&&(c.refresh(!1),0>y&&(y=p?250:this.vwr.getScreenWidth()),0>F&&(F=p?250:this.vwr.getScreenHeight()));z=new java.util.Hashtable;null!=x&&z.put("fileName",x);z.put("backgroundColor",Integer.$valueOf(this.vwr.getBackgroundArgb()));z.put("type",g);if(p){z.put("is2D",Boolean.TRUE);var L,c="smiles could not be generated";try{if(L=this.vwr.getOpenSmiles(null),0<L.length){var I=this.vwr.setLoadFormat("_"+L,"2",!1),I=I+("?width="+y+"&height="+F+"&format="+g.toLowerCase());
this.showString(I);c=this.vwr.fm.getFileAsBytes(I,null)}}catch(H){if(!P(H,Exception))throw H;}if(M(c,String))return this.showString(c),null;C=c}M(C,String)&&-2147483648==E?z.put("text",C):M(C,Array)&&z.put("bytes",C);null!=f&&z.put("scripts",f);null!=G&&z.put("bsFrames",G);z.put("fullPath",b);z.put("quality",Integer.$valueOf(E));z.put("width",Integer.$valueOf(y));z.put("height",Integer.$valueOf(F));z.put("nVibes",Integer.$valueOf(A));c=this.vwr.processWriteOrCapture(z);null==c&&(c="canceled");l&&
c.startsWith("OK")&&(c+="; width="+y+"; height="+F);e&&this.showString(JU.Logger.getTimerMsg("write",0));return this.writeMsg(c+(null==d?"":d))},"~A");l(c$,"prepareBinaryOutput",function(a){var c=a.getMap();if(null==c||!c.containsKey("$_BINARY_$"))return null;a=new JU.Lst;for(var b,c=c.entrySet().iterator();c.hasNext()&&((b=c.next())||1);){var e=b.getKey();if(!e.equals("$_BINARY_$")){var f=b.getValue(),d=15==f.tok?f.value.data:null;null==d&&(f=f.asString(),d=f.startsWith(";base64,")?JU.Base64.decodeBase64(f):
f.getBytes());if(e.equals("_DATA_")){a=new JU.Lst;a.addLast(d);break}else e.equals("_IMAGE_")?(a.add(0,e),a.add(1,null),a.add(2,d)):(a.addLast(e),a.addLast(null),a.addLast(d))}}return a},"JS.SV");l(c$,"writeMsg",function(a){if(this.chk||null==a)return"";var c=!a.startsWith("OK");c&&(this.e.evalError(a,null),alert(a));this.e.report(a,c);return a},"~S");l(c$,"show",function(){var a=this.e,c=null,b=this.paramAsStr(1),e=null,f=0;3<this.slen&&268435632==this.tokAt(this.slen-3)&&268435568==this.tokAt(this.slen-
2)?(e="!/"+this.paramAsStr(this.slen-1),this.slen-=3,f=3):2<this.slen&&268435632==this.tokAt(this.slen-2)?(e="/"+this.paramAsStr(this.slen-1),this.slen-=2,f=2):0==(e=this.paramAsStr(this.slen-1)).lastIndexOf("/")?(this.slen--,f=1):e=null;var d=null,j=null,h=2,g=this.getToken(1),j=M(g,JS.SV)&&1073741824!=g.tok?0:g.tok;4==j&&(g=JS.T.getTokenFromName(b.toLowerCase()),null!=g&&(j=g.tok));1296041986!=j&&(1073742158!=j&&1715472409!=j&&1228935687!=j)&&this.checkLength(-3);2==this.slen&&0<=b.indexOf("?")&&
(d=this.vwr.getAllSettings(b.substring(0,b.indexOf("?"))),j=-1);switch(j){case 0:this.chk||(d=a.theToken.escape());break;case 603984065:this.chk||(d=this.vwr.stm.getUndoInfo());break;case 1073741925:a.checkLength23();h=this.st.length;this.chk||(d=this.vwr.getModelInfo("domains"),d=M(d,JS.SV)?this.vwr.getAnnotationInfo(d,a.optParameterAsString(2),1073741925):"domain information has not been loaded");break;case 1715472409:d=this.plot(this.st);h=this.st.length;break;case 1073742189:a.checkLength23();
h=this.st.length;this.chk||(d=this.vwr.getModelInfo("validation"),d=M(d,JS.SV)?this.vwr.getAnnotationInfo(d,a.optParameterAsString(2),1073742189):"validation information has not been loaded");break;case 134221829:this.chk||(d=JU.Escape.e(this.vwr.fm.cacheList()));break;case 1111490587:a.checkLength23();h=this.st.length;this.chk||(d=this.vwr.getModelInfo("dssr"),d=null==d?"no DSSR information has been read":2<h?JS.SV.getVariable(this.vwr.extractProperty(d,this.stringParameter(2),-1)).asString():""+
JS.SV.getVariable(d).asString());break;case 1073741915:j=2;3==this.slen?j=A(this.floatParameter((h=3)-1)):this.checkLength(2+f);this.chk||(d=this.vwr.calculateStructures(null,!0,!1,j));break;case 545259572:this.checkLength(2+f);this.chk||(d=this.vwr.fm.getPathForAllFiles());break;case 1275203608:if(!this.chk){var n=Array(2);this.vwr.shm.getShapePropertyData(21,"allInfo",n);d=JS.SV.getVariable(n[1]).asString()}break;case 1073742038:this.chk||this.vwr.getNMRPredict(a.optParameterAsString(2));return;
case 603983903:!this.chk&&3==this.slen&&(d=""+this.vwr.getModelkitPropertySafely(a.stringParameter(2)),h=3);break;case 1275068433:case 1073741978:case 1073741929:case 1073741879:case 134218757:this.checkLength((1073741879==j||134218757==j&&1073742335==this.tokAt(2)?h=3:2)+f);if(this.chk)return;var m=a.optParameterAsString(2);1073741879==j&&("mf".equals(m)&&(m="formula"),"formula".equals(m)&&(d=this.vwr.getModelInfo("formula"),null!=d&&(d=JU.PT.rep(d," ",""))));if(null==d){try{switch(j){case 1275068433:d=
this.vwr.getInchi(this.vwr.bsA(),null,null);null==d&&(d="?");break;case 1073741978:d=this.vwr.getInchi(this.vwr.bsA(),null,"key");break;case 134218757:m.equalsIgnoreCase("true")?(d=this.vwr.getBioSmiles(null),e=null):null!=e&&(d=this.vwr.getSmilesOpt(null,-1,-1,1,e+"///"),e=null);break;default:d=this.vwr.ms.getModelDataBaseName(this.vwr.bsA()),d=null!=d&&(d.startsWith("$")||d.startsWith(":"))?d.substring(1):null}null==d&&(n=JU.Logger.getLogLevel(),JU.Logger.setLogLevel(4),d=134218757==j?this.vwr.getSmiles(null):
this.vwr.getOpenSmiles(null),JU.Logger.setLogLevel(n))}catch(l){if(P(l,Exception))d=l.getMessage(),null==d&&(d=""),l.printStackTrace();else throw l;}switch(j){case 1073741929:if(0<d.length){this.vwr.fm.loadImage(this.vwr.setLoadFormat("_"+d,"2",!1),"\u0001"+d,!1);return}d="Could not show drawing -- Either insufficient atoms are selected or the model is a PDB file.";break;case 1073741879:h=3,0<d.length?(d=this.vwr.getChemicalInfo(d,m,this.vwr.bsA()),0<=d.indexOf("FileNotFound")&&(d="?")):d="Could not show name -- Either insufficient atoms are selected or the model is a PDB file."}}break;
case 134217764:case 1296041986:d="";n=null;if(2==(h=this.slen)){if(this.chk)break;n=this.vwr.getSymTemp().getSpaceGroupInfo(this.vwr.ms,null,-1,!1,null)}else if(134217764==j){n=this.paramAsStr(2);h=3;if(this.chk)break;n=this.vwr.getSymTemp().getSpaceGroupInfo(this.vwr.ms,JU.PT.rep(n,"''",'"'),-1,!1,null)}if(null!=n){d=(134217764==j?""+n.get("spaceGroupInfo")+n.get("spaceGroupNote"):"")+(n.containsKey("symmetryInfo")?n.get("symmetryInfo"):"");break}var j=2==this.tokAt(2)?this.intParameter(2):0,n=4==
this.tokAt(2)||12==this.tokAt(2)?this.paramAsStr(2):null,g=m=null,t=-1;if(3<this.slen&&4!=this.tokAt(3)){h=B(-1,[null,this.vwr.getFrameAtoms()]);m=a.centerParameter(2+(0==j?0:1),h);if(null!=h[0]&&0==h[0].cardinality()){h=this.slen;break}h[0]=null;g=a.centerParameter(++a.iToken,h);if(null!=h[0]&&0==h[0].cardinality()){h=this.slen;break}0==j&&2==this.tokAt(a.iToken+1)&&(t=a.getToken(++a.iToken).intValue)}var k=1<a.iToken&&4==this.tokAt(a.iToken+1)?this.stringParameter(++a.iToken):null;this.checkLength((h=
++a.iToken)+f);this.chk||(d=this.vwr.getSymmetryInfo(this.vwr.getAllAtoms().nextSetBit(0),n,j,null,m,g,0,k,0,t,0),d=null==d?"":M(d,java.util.Map)?JS.SV.getVariable(d).asString():d.toString());break;case 1648363544:j=null;2<this.slen&&(h=this.slen,j=J.c.VDW.getVdwType(this.paramAsStr(2)),null==j&&this.invArg());this.chk||(d=this.vwr.getDefaultVdwNameOrData(0,j,null));break;case 134320141:a.checkLength23();h=this.slen;j=a.optParameterAsString(2);if(null==e&&0<=(m=j.indexOf("/")))e=j.substring(m+1),
j=j.substring(0,m);this.chk||(d=this.vwr.getFunctionCalls(j));break;case 36867:this.checkLength(2+f);this.chk||(d=this.vwr.getAllSettings(null));break;case 1073742166:d=this.vwr.getFrameTitle();break;case 1073742184:2==this.slen?this.chk||this.vwr.showUrl(a.getFullPathName(!1)):(j=this.paramAsStr(2),this.chk||this.vwr.showUrl(j));return;case 1765808134:b="defaultColorScheme";break;case 1610612740:b="scaleAngstromsPerInch";break;case 134221850:case 4138:if(this.chk)return;0>this.vwr.am.cmi&&a.errorStr(30,
"show "+a.theToken.value);d=this.plot(this.st);h=this.slen;break;case 14:case 1112152078:this.chk||(d=this.getContext(!1));break;case 1073741888:j=a.optParameterAsString(2);0<j.length&&(h=3);this.chk||(c=this.vwr.cm.getColorSchemeList(j));break;case 1073742192:this.chk||(d=this.vwr.getAtomDefs(this.vwr.definedAtomSets)+this.vwr.g.getVariableList()+this.getContext(!0));break;case 536870926:this.chk||(d=this.vwr.getTrajectoryState());break;case 553648144:c=""+JS.ScriptEval.commandHistoryLevelMax;break;
case 553648149:c=""+JU.Logger.getLogLevel();break;case 603979825:c=""+this.vwr.getBoolean(603979825);break;case 553648178:d="set strandCountForStrands "+this.vwr.getStrandCount(12)+"; set strandCountForMeshRibbon "+this.vwr.getStrandCount(13);break;case 536875070:d=this.vwr.showTimeout(2==(h=this.slen)?null:this.paramAsStr(2));break;case 536870918:c=JU.Escape.eP(this.vwr.getDefaultLattice());break;case 4126:this.chk||(d=this.vwr.getMinimizationInfo());break;case 1611272194:switch(this.vwr.g.axesMode){case 603979808:d=
"set axesUnitcell";break;case 603979804:d="set axesMolecular";break;default:d="set axesWindow"}break;case 1610612737:d="set bondMode "+(this.vwr.getBoolean(603979812)?"OR":"AND");break;case 1649022989:this.chk||(d="set strandCountForStrands "+this.vwr.getStrandCount(12)+"; set strandCountForMeshRibbon "+this.vwr.getStrandCount(13));break;case 1613238294:d="set hbondsBackbone "+this.vwr.getBoolean(603979852)+";set hbondsSolid "+this.vwr.getBoolean(603979854);break;case 1611141175:this.chk||(d=this.vwr.getSpinState());
break;case 1611141176:d="set ssbondsBackbone "+this.vwr.getBoolean(603979952);break;case 1610625028:case 1611141172:d="selectionHalos "+(this.vwr.getSelectionHalosEnabled()?"ON":"OFF");break;case 1612709894:d="set selectHetero "+this.vwr.getBoolean(1612709894);break;case 1073741828:d=JU.Escape.eAP(this.vwr.getAdditionalHydrogens(null,null,768));break;case 1612709900:d="set selectHydrogens "+this.vwr.getBoolean(1612709900);break;case 553648130:case 553648138:case 536870924:case 553648176:case 553648172:case 1073741995:this.chk||
(d=this.vwr.getLightingState());break;case 1073742136:case 4146:this.chk||(d=this.vwr.stm.listSavedStates());break;case 1814695966:this.chk||(d=this.vwr.getUnitCellInfoText());break;case 1073742329:if(2==(h=this.slen)){this.chk||(d=this.vwr.getCoordinateState(this.vwr.bsA()));break}j=this.paramAsStr(2);this.chk||(d=this.vwr.stm.getSavedCoordinates(j));break;case 1073742158:!this.chk&&(null==a.outputBuffer&&null==e)&&this.vwr.sm.clearConsole();if(2==(h=this.slen)){this.chk||(d=this.vwr.getStateInfo());
break}if(null!=e&&3==this.slen){this.chk||(d=this.vwr.getStateInfo());break}else if(1228935687==this.tokAt(2)&&4==(h=this.slen)){this.chk||(d=this.vwr.fm.getEmbeddedFileState(this.paramAsStr(3),!0,"state.spt"));break}h=3;j=this.paramAsStr(2);this.chk||(d=this.vwr.stm.getSavedState(j));break;case 1639976963:if(2==(h=this.slen)){this.chk||(d=this.vwr.ms.getProteinStructureState(this.vwr.bsA(),134222350));break}j=this.paramAsStr(2);this.chk||(d=this.vwr.stm.getSavedStructure(j));break;case 134221834:j=
3==(h=this.slen)?this.paramAsStr(2):null;this.chk||(d=this.vwr.getDataObj(j,null,-2),d=null==d?"no data":JU.Escape.encapsulateData(d[0],d[1],d[3].intValue()));break;case 1073742330:h=3;d=a.setObjectProperty();break;case 1678381065:this.chk||(d=this.vwr.ms.getBoundBoxCommand(!0));break;case 12289:this.chk||(d="center "+JU.Escape.eP(this.vwr.tm.fixedRotationCenter));break;case 135176:this.chk||(d=this.getShapeProperty(22,"command"));break;case 1228935687:if(2==this.slen){this.chk||(null==e&&this.vwr.sm.clearConsole(),
d=this.getCurrentModelFileAsString());null==d&&(d="<unavailable>");break}h=3;c=this.paramAsStr(2);this.chk||(null==e&&this.vwr.sm.clearConsole(),d=this.vwr.getFileAsString3(c,!0,null));break;case 4115:d=1073742327==this.tokAt(2)&&0<(h=3)?this.vwr.getModelFileInfoAll():this.vwr.getModelFileInfo();break;case 1610616855:j=2==(h=this.slen)?2147483647:this.intParameter(2);1>j&&this.invArg();this.chk||(this.vwr.sm.clearConsole(),0==a.scriptLevel&&this.vwr.removeCommand(),d=this.vwr.getSetHistory(j));break;
case 135180:this.chk||(d=this.getShapeProperty(24,"jvxlDataXml"));break;case 1073877011:case 1073877010:a.optParameterAsString(2).equalsIgnoreCase("list")?(this.e.sm.loadShape(27),d=this.chk?"":this.getShapeProperty(27,"list -1"),h=3):(n=2==(h=this.slen)?-2147483648:this.intParameter(2),this.chk||(d=this.getMoJvxl(n,1073877011==j)));break;case 1094717454:this.chk||(d=this.vwr.ms.getModelInfoAsString());break;case 537006096:this.chk||(d=this.vwr.getMeasurementInfoAsString());break;case 1073741864:h=
3;!this.chk&&this.slen==h&&(d=this.paramAsStr(2),d=this.vwr.getOrientation(JS.T.getTokFromName(d.equals("box")?"volume":d.equals("rotation")?"best":d),"best",null).toString());break;case 1073742132:j=this.tokAt(2),0==j?j=1073742132:h=3;case 1073742178:case 4129:this.chk||(d=this.vwr.getOrientation(j,null,null).toString());break;case 1073742077:h=2;if(3<this.slen)break;switch(j=this.tokAt(2)){case 1073742178:case 1073742132:case 4129:case 0:this.chk||(d=this.vwr.getOrientation(j,null,null).toString());
break;default:j=a.optParameterAsString(2),d=this.vwr.getOrientation(1073742034,j,null).toString()}h=this.slen;break;case 1073742088:this.chk||(d=this.vwr.ms.getPDBHeader(this.vwr.am.cmi));break;case 1275068447:j=a.optParameterAsString(2);0==j.length&&(j=null);h=this.slen;this.chk||(d=this.vwr.ms.getPointGroupAsString(this.vwr.bsA(),"show:"+j,0,0,null,null,null));break;case 1088421903:this.chk||(d=this.vwr.ms.getSymmetryInfoAsString());break;case 1073742176:this.chk||(d="transform:\n"+this.vwr.tm.matrixRotate.toString());
break;case 4168:d="zoom "+(this.vwr.tm.zoomEnabled?""+this.vwr.tm.getZoomSetting():"off");break;case 1611272202:d=this.vwr.getShowFrank()?"frank ON":"frank OFF";break;case 1665140738:b="solventProbeRadius";break;case 1086324744:if(3==(h=this.slen)&&1073742334==this.tokAt(2))j=1086324743;case 1073741863:case 1086326788:case 1073742120:case 1113589787:case 1086324742:case 1140850689:case 1073741982:this.chk||(d=this.vwr.getChimeInfo(j));break;case 537022465:case 1610612738:case 20482:case 1612709912:c=
"?";break;case 1073742030:j=2==(h=this.slen)?null:this.paramAsStr(2);this.chk||(d=this.vwr.getBindingInfo(j));break;case 1073742015:this.chk||(c=this.vwr.getMenu(""));break;case 1073741824:b.equalsIgnoreCase("fileHeader")&&(this.chk||(d=this.vwr.ms.getPDBHeader(this.vwr.am.cmi)));break;case 1073741992:case 36868:b=this.paramAsStr(h++),n=a.getParameter(b,1073742190,!0),this.chk||(d=1073741992==j?n.toJSON():n.escape())}this.checkLength(h+f);this.chk||(null!=d?this.showString(this.filterShow(d,e)):null!=
c?this.showString(b+" = "+c):null!=b&&(0<=b.indexOf(" ")?this.showString(b):this.showString(b+" = "+a.getParameter(b,1073742190,!0).escape())))});l(c$,"getCurrentModelFileAsString",function(){return this.vwr.getFileAsString(""+this.vwr.getParameter("_modelFile"))});l(c$,"filterShow",function(a,c){if(null==c)return a;var b=c.startsWith("!/");c=c.substring(b?2:1).toLowerCase();for(var e=JU.PT.split(a,"\n"),f=new JU.SB,d=0;d<e.length;d++)0>e[d].toLowerCase().indexOf(c)==b&&f.append(e[d]).appendC("\n");
return f.toString()},"~S,~S");l(c$,"stereo",function(){for(var a=J.c.STER.DOUBLE,c=-5,b=!1,e=null,f=0,d=1;d<this.slen;++d)if(this.e.isColorParam(d))1<f&&this.e.bad(),0==f&&(e=I(2,0)),b||(c=3),e[f]=this.e.getArgbParam(d),0==f++&&(e[1]=~e[0]),d=this.e.iToken;else switch(this.getToken(d).tok){case 1073742335:this.e.checkLast(this.e.iToken=1);this.e.iToken=1;break;case 1073742334:this.e.checkLast(this.e.iToken=1);a=J.c.STER.NONE;break;case 2:case 3:c=this.floatParameter(d);b=!0;break;case 1073741824:if(b||
(c=3),a=J.c.STER.getStereoMode(this.paramAsStr(d)),null!=a)break;default:this.invArg()}this.chk||this.vwr.setStereoMode(e,a,c)});l(c$,"struts",function(){var a=this.e,c=1073742072==this.tokAt(1)||1073742335==this.tokAt(1)||1==this.slen,b=a.getMadParameter();if(2147483647==b)return!1;c&&(b=Math.round(2E3*this.vwr.getFloat(570425406)));this.setShapeProperty(1,"type",Integer.$valueOf(32768));a.setShapeSizeBs(1,b,null);this.setShapeProperty(1,"type",Integer.$valueOf(1023));return!0});l(c$,"unitcell",
function(a,c){var b=this.e,e=2147483647,f=2147483647,d=null,j=b.tickParamAsStr(a,!0,!1,!1);a=b.iToken;var h=null,g=null,n=null,m=null,l=f=!1,t=this.vwr.getCurrentUnitCell(),k=this.tokAt(++a);switch(k){case 4142:case 4141:l=!0;d=JU.P4.new4(0,0,0,-1);b.iToken++;break;case 2097180:m=b.hklParameter(a+1,null,!1);f=b.getPointOrPlane(a+1,7);a=b.iToken;k=NaN;this.isFloatParameter(a+1)&&(k=this.floatParameter(++a),268435634==this.tokAt(a+1)&&(k=-k/100,a++));var q=NaN,v=!1;this.isFloatParameter(a+1)&&(q=this.floatParameter(++a),
268435634==this.tokAt(a+1)&&(v=!0,a++));if(this.chk)return;var w=1073742172==this.tokAt(a+1);w&&a++;b.iToken=a;M(f,JU.P3)?f=JU.P4.new4(f.x,f.y,f.z,0):Float.isNaN(q)&&(q=f.w);var g=this.getUVBoxFromHKL(t,f,m),u=new JU.P3,p=new JU.V3;JU.Measure.getPlaneProjection(new JU.P3,m,u,p);0<k?(g[3].normalize(),g[3].scale(k)):0>k&&g[3].scale(-k);!Float.isNaN(q)&&0!=q&&(v&&(q=q/100*g[3].length()),g[0].scaleAdd2(q,p,g[0]));w&&g[0].scaleAdd2(-g[3].length(),p,g[0]);m="surface"+A(f.x)+A(f.y)+A(f.z);break;case 536875009:case 1073742163:d=
536875009==k?b.getPointOrPlane(++a,19):b.checkHKL(b.getFractionalPoint(++a));a=b.iToken;g=t.getUnitCellVectors();g[1].scale(Math.abs(d.x));g[2].scale(Math.abs(d.y));g[3].scale(Math.abs(d.z));d=null;m="supercell";break;case 1073741938:d=JU.SimpleUnitCell.ptToIJK(b.checkHKL(b.getFractionalPoint(++a)),1);a=b.iToken;break;case 4:case 1073741824:m=k=this.paramAsStr(a).toLowerCase();if(0<=k.indexOf(",")||this.chk){n=k;break}f=null;b.setModelCagePts(-1,null,null);n=this.vwr.getModelInfo("unitcell_conventional");
if(JU.PT.isOneOf(m,";parent;standard;primitive;")){if(null==n&&null!=this.vwr.getModelInfo("isprimitive")){this.showString("Cannot convert unit cell when file data is primitive and have no lattice information");return}m.equals("primitive")&&4==this.tokAt(a+1)&&(f=this.paramAsStr(++a).toUpperCase())}M(n,Array)&&(g=n);null==f&&(f=this.vwr.getModelInfo("latticeType"));null!=n&&b.setModelCagePts(-1,this.vwr.getV0abc(-1,n),""+n);if(!m.equals("conventional"))if(k=this.vwr.getModelInfo("unitcell_"+m),null==
k){if((k=m.equals("primitive"))||m.equals("reciprocal")){q=this.slen==a+1?1:2==this.tokAt(a+1)?3.141592653589793*this.intParameter(++a):this.floatParameter(++a);m=(null==t?"":t.getSpaceGroupName()+" ")+m;g=null==t?B(-1,[JU.P3.new3(0,0,0),JU.P3.new3(1,0,0),JU.P3.new3(0,1,0),JU.P3.new3(0,0,1)]):t.getUnitCellVectors();null==f&&(f=this.vwr.getSymmetryInfo(this.vwr.getFrameAtoms().nextSetBit(0),null,0,null,null,null,1073741994,null,0,-1,0));null==t&&(t=this.vwr.getSymTemp());t.toFromPrimitive(!0,0==f.length?
"P":f.charAt(0),g,this.vwr.getCurrentModelAuxInfo().get("primitiveToCrystal"));k||JU.SimpleUnitCell.getReciprocal(g,g,q);break}}else m=k,0<=k.indexOf(",")&&(n=k);break;case 135180:case 1073742330:h=b.objectNameParameter(++a);break;case 1678381065:g=JU.P3.newP(this.vwr.getBoundBoxCenter());d=this.vwr.getBoundBoxCornerVector();g.sub(d);g=B(-1,[g,JU.P3.new3(2*d.x,0,0),JU.P3.new3(0,2*d.y,0),JU.P3.new3(0,0,2*d.z)]);d=null;b.iToken=a;break;case 1073742176:12!=this.tokAt(++a)&&this.invArg();n=B(-1,[this.getToken(a).value]);
break;case 11:case 12:n=this.getToken(a).value;break;case 12289:switch(this.tokAt(++a)){case 12290:case 10:case 1073742325:d=this.vwr.ms.getAtomSetCenter(this.atomExpressionAt(a));this.vwr.toFractional(d,!0);a=b.iToken;break;default:if(b.isCenterParameter(a)){d=this.centerParameter(a);a=b.iToken;break}this.invArg()}d.x-=0.5;d.y-=0.5;d.z-=0.5;break;case 12290:case 10:case 1073742325:f=this.atomExpressionAt(a).nextSetBit(0);this.chk||this.vwr.am.setUnitCellAtomIndex(f);if(0>f)return;a=b.iToken;break;
case 1073742066:if(f=!0,b.isAtomExpression(a+1)){d=b.centerParameter(++a,null);this.vwr.toFractional(d,!1);a=b.iToken;break}case 1073742114:d=b.getFractionalPoint(++a);M(d,JU.P4)?f&&this.invArg():d=!f&&555>d.x?JU.SimpleUnitCell.ptToIJK(b.checkHKL(d),1):JU.P4.new4(d.x,d.y,d.z,f?1:0);a=b.iToken;break;case 3:case 2:if(111>this.floatParameter(a)){a--;break}e=this.intParameter(a);break;default:b.isArrayParameter(a)?(g=b.getPointArray(a,4,!1),a=b.iToken):this.slen>a+1?(d=b.getFractionalPoint(a),a=b.iToken):
a--}f=b.getSetAxesTypeMad10(++a);b.checkLast(b.iToken);if(!(this.chk||2147483647==f)){2147483647==f&&this.vwr.am.setUnitCellAtomIndex(-1);null==g&&null!=n&&(g=this.vwr.getV0abc(-1,n));if(2147483647!=e)JM.ModelSet.setUnitCellOffset(t,null,e);else if(null!=h)this.vwr.setCurrentCage(h);else if(l||null!=g){e=c?t:null;if(null!=e){if(h=this.vwr.getFrameAtoms(),n=h.cardinality(),l=0==n,!l){n=Array(n);t=this.vwr.ms.at;k=h.nextSetBit(0);for(q=0;0<=k;k=h.nextSetBit(k+1),q++)n[q]=JU.P3.newP(t[k]),this.vwr.toFractionalUC(e,
n[q],!1);b.setModelCagePts(-1,g,m);e=this.vwr.getCurrentUnitCell();k=h.nextSetBit(0);for(q=0;0<=k;k=h.nextSetBit(k+1),q++)t[k].setT(n[q]),this.vwr.toCartesianUC(e,t[k],!1);this.vwr.ms.setTaintedAtoms(h,2)}}else l=!0;l&&b.setModelCagePts(-1,g,m)}b.setObjectMad10(33,"unitCell",f);null!=d&&JM.ModelSet.setUnitCellOffset(this.vwr.getCurrentUnitCell(),d,0);null!=j&&this.setShapeProperty(33,"tickInfo",j);null!=m&&this.showString(m+(null==g?"":" "+JU.Escape.e(g)))}},"~N,~B");l(c$,"getUVBoxFromHKL",function(a,
c,b){var e=A(c.x),f=A(c.y),d=A(c.z);for((0==e&&0==f&&0==d||e!=c.x||f!=c.y||d!=c.z)&&this.invArg();0==e%2&&0==f%2&&0==d%2;)e/=2,f/=2,d/=2;c=a.getUnitCellVectors();for(var j=b.w,h=JU.P4.new4(b.x,b.y,b.z,0),g=Math.max(Math.max(e,f),d),g=JU.Measure.getLatticePoints(a.getLatticeCentering(),0==e?0:g,0==f?0:g,0==d?0:g),l=0;l<g.size();l++)a.toCartesian(g.get(l),!0);for(var g=JU.Measure.getPointsOnPlane(g.toArray(Array(g.size())),h),h=new JU.P3,l=-179,m=3.4028235E38,r=3.4028235E38,t=a=null,k=l,q=3.4028235E38,
v,w=g.size();0<=--w;){var u=g.get(w);v=u.length();var p=!1,s=!1;if(!(0.01>v||null!=a&&(k=Math.abs(JU.Measure.computeTorsion(a,h,b,u,!0)))>-l))null==a?(a=u,m=v):v<m-0.01?(s=!0,k=q=3.4028235E38,p=!0):v<r-0.01?(q=3.4028235E38,p=!0):v<r+0.01&&(p=!0),p&&(p=89<k,s||v<m+0.1&&-0.01<=u.x&&0.01>=u.y&&p&&(3.4028235E38==q||89>q)?(t=a,r=m,a=u,m=v,!s&&k<q&&(q=k)):v<r+0.1&&p&&(t=u,r=v,k<q&&(q=k)))}null==a&&this.invArg();m=null;if(null!=t)k=JU.Measure.computeTorsion(a,h,b,t,!0),0<k?(m=a,a=t):m=t;else for(w=g.size();0<=
--w;)u=g.get(w),k=JU.Measure.computeTorsion(a,h,b,u,!0),-89.9>k&&k>l+0.01&&(l=k,m=u);null==m&&this.invArg();c[1]=m;c[2]=a;b=1==((0>e?1:0)+(0>f?1:0)+(0>d?1:0))%2;g=c[3];h=JU.P3.newP(c[1]);l=JU.P3.newP(c[2]);0==e&&0==f?(l.scale(-1),h.scale(-1),c[1]=h,c[2]=l):!(0==e&&0==d)&&(0==f&&0==d)&&(h.scale(-1),l.scale(-1),c[1]=l,c[2]=h);b&&(h=c[1],c[1]=c[2],c[2]=h);g.cross(a,m);g.normalize();g.scale(j);return c},"J.api.SymmetryInterface,JU.P4,JU.P4");l(c$,"modelkit",function(){var a=0,c=this.tokAt(1);switch(c){case 603984065:case 4139:this.chk&&
this.e.cmdUndoRedo(603984065==c?4165:4140);return;case 1073742334:if(2==this.slen&&null==this.vwr.getModelkitPropertySafely("exists"))return;case 0:case 1073742335:this.chk||this.vwr.setBooleanProperty("modelkitmode",1073742334!=c);if(0==this.tokAt(a+1))return;a=++this.e.iToken;break;case 528432:case 4145:this.e.cmdRotate(!1,!0);return;case 4098:++this.e.iToken;case 134217764:case 4106:case 12291:case 1275069441:case 4129:case 1073742080:this.assign();return;case 4130:++this.e.iToken;this.mutate();
return}for(var b=this.vwr.getModelkit(!1);0!=(c=this.tokAt(++a));){var e=this.paramAsStr(a).toLowerCase(),f=null;switch(c){case 1073742335:case 1073742334:this.chk||(this.vwr.setBooleanProperty("modelkitmode",1073742335==c),1073742334==c&&this.vwr.setStringProperty("picking","identify"));continue;case 1610625028:case 12294:e="hidden";f=Boolean.$valueOf(1610625028!=c);break;case 12293:var e="constraint",f="",d=c=null,j=null;switch(this.tokAt(++a)){case 1073742334:case 1073742333:this.chk||this.vwr.setBooleanProperty("dragPicking",
!1);break;case 135198:c=this.e.getPoint3f(++a,!0,!0);a=this.e.iToken;d=this.e.getPoint3f(++a,!0,!0);f=null;break;case 134219777:j=this.e.hklParameter(++a,null,!0);f=null;break;case 134217750:j=this.e.planeParameter(++a,!1);f=null;break;default:this.invArg()}null==f?((null==c||null==d)==(null==j)&&this.invArg(),f=B(-1,[c,d,j])):f=null;a=this.e.iToken;break;case 36867:e=this.paramAsStr(++a);f=0==this.tokAt(++a)?"true":this.paramAsStr(a);break;case 1296041986:switch(this.tokAt(++a)){case 4:case 1073742333:f=
this.paramAsStr(a);break;case 12:f=this.getToken(a).value;break;case 2:f=Integer.$valueOf(this.getToken(a).intValue);break;default:this.e.isCenterParameter(a)?(e="center",f=this.e.centerParameter(a,null),a=this.e.iToken):this.invArg()}break;case 1073742066:if(f=this.paramAsStr(a+1),f.equals("none")){++a;break}case 134217751:case 12289:f=this.e.atomCenterOrCoordinateParameter(++a,null);a=this.e.iToken;break;case 1073742024:f=this.paramAsStr(++a).toLowerCase();this.vwr.isModelKitOption("M",f)||this.invArg();
break;case 1814695966:f=this.paramAsStr(++a).toLowerCase();if(!this.vwr.isModelKitOption("U",f)){this.unitcell(2,!0);return}break;case 1088421903:f=this.paramAsStr(++a).toLowerCase();this.vwr.isModelKitOption("S",f)||this.invArg();break;default:if(this.vwr.isModelKitOption("B",e)){f=Boolean.$valueOf(0==(c=this.tokAt(++a))||1073742335==c);break}if(this.vwr.isModelKitOption("M",e)){f=e;e="mode";break}if(this.vwr.isModelKitOption("U",e)){f=e;e="unitcell";break}this.invArg()}!this.chk&&(null!=f&&null!=
(f=b.setProperty(e,f))&&"hidden"!==e&&!b.isHidden())&&this.vwr.showString("modelkit "+e+" = "+f.toString(),!1)}});l(c$,"assign",function(){var a=1073742335==this.tokAt(this.slen-1),c=++this.e.iToken,b=this.tokAt(c),e=-1,f=-1,d=1140850689==b,j=1677721602==b,h=4106==b,g=12291==b,l=1275069441==b,m=4129==b,r=134217764==b,t=1073742080==b,k=null;d||j||h||r||g||m||l||t?c++:b=1140850689;0>this.vwr.am.cmi&&this.invArg();var q=this.vwr.getThisModelAtoms(),v=null;if(j){if(2==this.tokAt(c))e=this.e.intParameter(c);
else if(M(this.getToken(c).value,JM.BondSet))e=this.getToken(c).value.nextSetBit(0);else switch(v=this.expFor(c,q),e=v.nextSetBit(0),v.cardinality()){case 1:v=this.expFor(++this.e.iToken,q),f=v.nextSetBit(0),0>f&&this.invArg(),v.set(e);case 2:v=this.vwr.ms.getBondsForSelectedAtoms(v,!1);0<v.cardinality()?e=v.nextSetBit(0):(h=!0,b=4106);break;default:this.invArg()}c=++this.e.iToken}else if(1073742080==b)v=q;else if(!(1140850689==b&&4==this.tokAt(c)||1275069441==b))if(!r||this.e.isAtomExpression(c)){v=
this.expFor(c,q);e=v.nextSetBit(0);if(0>e)return;c=++this.e.iToken}var w=j=null;l?(this.e.isAtomExpression(c)?(v=this.expFor(++this.e.iToken,q),c=this.e.iToken,j=this.e.optParameterAsString(c+1),j.toLowerCase().equals("packed")&&(t=!0,j="")):j=this.e.optParameterAsString(c),this.e.isPoint3f(this.e.iToken+1)?w=this.getPoint3f(++this.e.iToken,!0):this.e.isArrayParameter(this.e.iToken+1)&&(k=this.e.getPointArray(this.e.iToken+1,-1,!1)),0==j.length&&(j=null),1073742080==this.tokAt(this.e.iToken+1)&&(t=
!0,++this.e.iToken)):m?w=this.getPoint3f(c,!0):r?(j=this.e.optParameterAsString(c),1073742080==this.tokAt(this.e.iToken+1)&&(t=!0,++this.e.iToken)):h?!g&&0>f&&(v=this.expFor(c,q),f=v.nextSetBit(0),j=this.e.optParameterAsString(++this.e.iToken)):(j=this.e.optParameterAsString(c),d&&(w=++this.e.iToken<(a?this.slen-1:this.slen)?this.centerParameter(this.e.iToken):null));if(!this.chk)switch(this.vwr.pushState(),b){case 1140850689:this.e.clearDefinedVariableAtomSets();this.vwr.getModelkit(!1).cmdAssignAtom(e,
w,j,this.e.fullCommand,a);break;case 1677721602:this.vwr.getModelkit(!1).cmdAssignBond(e,(j+"-").charAt(0),this.e.fullCommand);break;case 4106:this.vwr.getModelkit(!1).cmdAssignConnect(e,f,(j+"1").charAt(0),this.e.fullCommand);break;case 1073742080:j=null;case 1275069441:null==w&&(null==q&&null==k)&&this.invArg();null==k&&null!=w&&(k=B(-1,[w]));a=this.vwr.getModelkit(!1).cmdAssignAddAtoms(j,k,v,t?"packed":"",this.e.fullCommand,a);this.e.doReport()&&this.e.report(J.i18n.GT.i(J.i18n.GT.$("{0} atoms added"),
a),!1);break;case 12291:a=this.vwr.getModelkit(!1).cmdAssignDeleteAtoms(v);this.e.doReport()&&this.e.report(J.i18n.GT.i(J.i18n.GT.$("{0} atoms deleted"),a),!1);break;case 4129:a=this.vwr.getModelkit(!1).cmdAssignMoveAtoms(v,e,w,!0);this.e.doReport()&&this.e.report(J.i18n.GT.i(J.i18n.GT.$("{0} atoms moved"),a),!1);break;case 134217764:this.e.doReport()&&this.e.showString(this.vwr.assignSpaceGroup(v,j,-1)),t&&(a=this.vwr.getModelkit(!1).cmdAssignAddAtoms(null,null,q,"packed",this.e.fullCommand,!1),
this.e.doReport()&&this.e.report(J.i18n.GT.i(J.i18n.GT.$("{0} atoms added"),a),!1))}});l(c$,"expFor",function(a,c){var b=JU.BS.copy(this.atomExpressionAt(a));b.and(c);return b},"~N,JU.BS");l(c$,"getContext",function(a){for(var c=new JU.SB,b=this.e.thisContext;null!=b;)a?null!=b.vars&&(c.append(this.getScriptID(b)),c.append(JV.StateManager.getVariableList(b.vars,80,!0,!1))):c.append(JS.ScriptError.getErrorLineMessage(b.functionName,b.scriptFileName,this.e.getLinenumber(b),b.pc,JS.ScriptEval.statementAsString(this.vwr,
b.statement,-9999,this.e.debugHigh))),b=b.parentContext;a?null!=this.e.contextVariables&&(c.append(this.getScriptID(null)),c.append(JV.StateManager.getVariableList(this.e.contextVariables,80,!0,!1))):c.append(this.e.getErrorLineMessage2());return c.toString()},"~B");l(c$,"getIsosurfaceJvxl",function(a,c){return this.chk?"":this.getShapeProperty(a,"PMESH"===c||"MESH"===c?"jvxlMeshX":"ISOMESH"===c?"pmesh":"ISOMESHBIN"===c||"PMB"===c?"pmeshbin":"jvxlDataXml")},"~N,~S");l(c$,"getMoJvxl",function(a,c){var b=
c?28:27;this.e.sm.loadShape(b);var e=this.vwr.am.cmi;0>e&&this.e.errorStr(30,"show/write MO/NBO");var f=this.vwr.ms.getInfo(e,"moData");null==f&&this.error(27);var d=this.getShapeProperty(b,"moNumber");(null==d||0==d.intValue())&&this.setShapeProperty(b,"init",Integer.$valueOf(e));this.setShapeProperty(b,"moData",f);return this.e.sm.getShapePropertyIndex(b,"showMO",a)},"~N,~B");l(c$,"getScriptID",function(a){return"\n# "+(null==a?this.e.functionName:"function "+a.functionName)+" (file "+(null==a?
this.e.scriptFileName:a.scriptFileName)+(null==a?"":" context "+a.id)+")\n"},"JS.ScriptContext");l(c$,"tokenAt",function(a,c){return a<c.length?c[a]:null},"~N,~A");c$.tokAtArray=l(c$,"tokAtArray",function(a,c){return a<c.length&&null!=c[a]?c[a].tok:0},"~N,~A");l(c$,"getPlotMinMax",function(a,c,b){if(null==a)return 0;switch(b){case 1111490568:case 1111490569:case 1111490570:return c?180:-180;case 1111490565:case 1111490576:return c?360:0;case 1111490574:return c?1:-1}b=c?-1E10:1E10;for(var e=a.length;0<=
--e;){var f=a[e];Float.isNaN(f)||c==f>b&&(b=f)}return b},"~A,~B,~N");l(c$,"parseDataArray",function(a,c){a=JU.Parser.fixDataString(a);var b=JU.Parser.markLines(a,"\n"),e=b.length;if(!c){for(var f=JU.AU.newFloat2(e),d=0,j=0;d<e;j=b[d++])j=JU.PT.getTokens(a.substring(j,b[d])),JU.PT.parseFloatArrayData(j,f[d]=O(j.length,0));return f}j=JU.PT.getTokens(a.substring(0,b[0]));if(3!=j.length)return O(0,0,0,0);var h=JU.PT.parseInt(j[0]),g=JU.PT.parseInt(j[1]),l=JU.PT.parseInt(j[2]);if(1>h||1>g||1>l)return O(1,
1,1,0);for(var f=JU.AU.newFloat3(h,g),m=0,r=0,d=1,j=b[0];d<e&&m<h;j=b[d++])j=JU.PT.getTokens(a.substring(j,b[d])),j.length<l||(JU.PT.parseFloatArrayData(j,f[m][r]=O(j.length,0)),++r==g&&(m++,r=0));return m!=h?(System.out.println("Error reading 3D data -- nX = "+h+", but only "+m+" blocks read"),O(1,1,1,0)):f},"~S,~B");l(c$,"getBitsetPropertyFloat",function(a,c,b,e,f){c=null==b||1111490843==c?this.e.getBitsetProperty(a,null,c,null,null,b,null,!1,2147483647,!1):this.vwr.getDataObj(b,a,1);if(null==c||
!JU.AU.isAF(c))return null==a?null:O(a.cardinality(),0);if(!Float.isNaN(e))for(a=0;a<c.length;a++)c[a]<e&&(c[a]=NaN);if(!Float.isNaN(f))for(a=0;a<c.length;a++)c[a]>f&&(c[a]=NaN);return c},"JU.BS,~N,~S,~N,~N");X(c$,"ERROR_invalidArgument",22)})})(Clazz,Clazz.getClassName,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,Clazz.doubleToLong,Clazz.declarePackage,Clazz.instanceOf,Clazz.load,Clazz.instantialize,Clazz.decorateAsClass,Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,
Clazz.exceptionOf,Clazz.newIntArray,Clazz.defineStatics,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,Clazz.declareInterface,Clazz.p0p,Clazz.pu$h,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,Clazz.newBooleanArray,Clazz.newCharArray,Clazz.implementOf,Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,
Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAB,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
